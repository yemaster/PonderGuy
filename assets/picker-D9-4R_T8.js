var wn=Object.defineProperty;var Mn=(n,s,e)=>s in n?wn(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var w=(n,s,e)=>(Mn(n,typeof s!="symbol"?s+"":s,e),e);import{at as H,R as Re,n as V,V as m,c as Se,au as Ne,av as Pn,aw as tt,ax as et,Q as fe,ay as de,a5 as En,a4 as On,B as ot,b as Wt,M as ut,ao as Pt,a as be,e as jn}from"./index-CE_QVOjg.js";const nt=new H,B=new Re,ct=new V,ye=new m,gt=new m,Ft=new m,ge=new Se;class Fo extends Ne{constructor(s,e,t){super(),t.style.touchAction="none";let o=null,c=null;const a=[],r=this;function h(){t.addEventListener("pointermove",P),t.addEventListener("pointerdown",A),t.addEventListener("pointerup",D),t.addEventListener("pointerleave",D)}function p(){t.removeEventListener("pointermove",P),t.removeEventListener("pointerdown",A),t.removeEventListener("pointerup",D),t.removeEventListener("pointerleave",D),t.style.cursor=""}function f(){p()}function g(){return s}function x(){return B}function P(b){if(r.enabled!==!1){if(E(b),B.setFromCamera(ct,e),o){B.ray.intersectPlane(nt,gt)&&o.position.copy(gt.sub(ye).applyMatrix4(ge)),r.dispatchEvent({type:"drag",object:o});return}if(b.pointerType==="mouse"||b.pointerType==="pen")if(a.length=0,B.setFromCamera(ct,e),B.intersectObjects(s,r.recursive,a),a.length>0){const d=a[0].object;nt.setFromNormalAndCoplanarPoint(e.getWorldDirection(nt.normal),Ft.setFromMatrixPosition(d.matrixWorld)),c!==d&&c!==null&&(r.dispatchEvent({type:"hoveroff",object:c}),t.style.cursor="auto",c=null),c!==d&&(r.dispatchEvent({type:"hoveron",object:d}),t.style.cursor="pointer",c=d)}else c!==null&&(r.dispatchEvent({type:"hoveroff",object:c}),t.style.cursor="auto",c=null)}}function A(b){r.enabled!==!1&&(E(b),a.length=0,B.setFromCamera(ct,e),B.intersectObjects(s,r.recursive,a),a.length>0&&(o=r.transformGroup===!0?s[0]:a[0].object,nt.setFromNormalAndCoplanarPoint(e.getWorldDirection(nt.normal),Ft.setFromMatrixPosition(o.matrixWorld)),B.ray.intersectPlane(nt,gt)&&(ge.copy(o.parent.matrixWorld).invert(),ye.copy(gt).sub(Ft.setFromMatrixPosition(o.matrixWorld))),t.style.cursor="move",r.dispatchEvent({type:"dragstart",object:o})))}function D(){r.enabled!==!1&&(o&&(r.dispatchEvent({type:"dragend",object:o}),o=null),t.style.cursor=c?"pointer":"auto")}function E(b){const d=t.getBoundingClientRect();ct.x=(b.clientX-d.left)/d.width*2-1,ct.y=-(b.clientY-d.top)/d.height*2+1}h(),this.enabled=!0,this.recursive=!0,this.transformGroup=!1,this.activate=h,this.deactivate=p,this.dispose=f,this.getObjects=g,this.getRaycaster=x}}const xe={type:"change"},Vt={type:"start"},we={type:"end"},xt=new Pn,Me=new H,Cn=Math.cos(70*En.DEG2RAD);class Vo extends Ne{constructor(s,e){super(),this.object=s,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new m,this.cursor=new m,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:tt.ROTATE,MIDDLE:tt.DOLLY,RIGHT:tt.PAN},this.touches={ONE:et.ROTATE,TWO:et.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(i){i.addEventListener("keydown",kt),this._domElementKeyEvents=i},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",kt),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(xe),t.update(),c=o.NONE},this.update=function(){const i=new m,u=new fe().setFromUnitVectors(s.up,new m(0,1,0)),y=u.clone().invert(),C=new m,k=new fe,_=new m,F=2*Math.PI;return function(xn=null){const me=t.object.position;i.copy(me).sub(t.target),i.applyQuaternion(u),r.setFromVector3(i),t.autoRotate&&c===o.NONE&&Z(It(xn)),t.enableDamping?(r.theta+=h.theta*t.dampingFactor,r.phi+=h.phi*t.dampingFactor):(r.theta+=h.theta,r.phi+=h.phi);let z=t.minAzimuthAngle,U=t.maxAzimuthAngle;isFinite(z)&&isFinite(U)&&(z<-Math.PI?z+=F:z>Math.PI&&(z-=F),U<-Math.PI?U+=F:U>Math.PI&&(U-=F),z<=U?r.theta=Math.max(z,Math.min(U,r.theta)):r.theta=r.theta>(z+U)/2?Math.max(z,r.theta):Math.min(U,r.theta)),r.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,r.phi)),r.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(f,t.dampingFactor):t.target.add(f),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor),t.zoomToCursor&&N||t.object.isOrthographicCamera?r.radius=Nt(r.radius):r.radius=Nt(r.radius*p),i.setFromSpherical(r),i.applyQuaternion(y),me.copy(t.target).add(i),t.object.lookAt(t.target),t.enableDamping===!0?(h.theta*=1-t.dampingFactor,h.phi*=1-t.dampingFactor,f.multiplyScalar(1-t.dampingFactor)):(h.set(0,0,0),f.set(0,0,0));let bt=!1;if(t.zoomToCursor&&N){let rt=null;if(t.object.isPerspectiveCamera){const at=i.length();rt=Nt(at*p);const yt=at-rt;t.object.position.addScaledVector(O,yt),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const at=new m(j.x,j.y,0);at.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix(),bt=!0;const yt=new m(j.x,j.y,0);yt.unproject(t.object),t.object.position.sub(yt).add(at),t.object.updateMatrixWorld(),rt=i.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;rt!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(rt).add(t.object.position):(xt.origin.copy(t.object.position),xt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(xt.direction))<Cn?s.lookAt(t.target):(Me.setFromNormalAndCoplanarPoint(t.object.up,t.target),xt.intersectPlane(Me,t.target))))}else t.object.isOrthographicCamera&&(bt=p!==1,bt&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix()));return p=1,N=!1,bt||C.distanceToSquared(t.object.position)>a||8*(1-k.dot(t.object.quaternion))>a||_.distanceToSquared(t.target)>0?(t.dispatchEvent(xe),C.copy(t.object.position),k.copy(t.object.quaternion),_.copy(t.target),!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",pe),t.domElement.removeEventListener("pointerdown",ae),t.domElement.removeEventListener("pointercancel",it),t.domElement.removeEventListener("wheel",ce),t.domElement.removeEventListener("pointermove",Lt),t.domElement.removeEventListener("pointerup",it),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",kt),t._domElementKeyEvents=null)};const t=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=o.NONE;const a=1e-6,r=new de,h=new de;let p=1;const f=new m,g=new V,x=new V,P=new V,A=new V,D=new V,E=new V,b=new V,d=new V,M=new V,O=new m,j=new V;let N=!1;const I=[],K={};let G=!1;function It(i){return i!==null?2*Math.PI/60*t.autoRotateSpeed*i:2*Math.PI/60/60*t.autoRotateSpeed}function q(i){const u=Math.abs(i*.01);return Math.pow(.95,t.zoomSpeed*u)}function Z(i){h.theta-=i}function $(i){h.phi-=i}const Q=function(){const i=new m;return function(y,C){i.setFromMatrixColumn(C,0),i.multiplyScalar(-y),f.add(i)}}(),st=function(){const i=new m;return function(y,C){t.screenSpacePanning===!0?i.setFromMatrixColumn(C,1):(i.setFromMatrixColumn(C,0),i.crossVectors(t.object.up,i)),i.multiplyScalar(y),f.add(i)}}(),J=function(){const i=new m;return function(y,C){const k=t.domElement;if(t.object.isPerspectiveCamera){const _=t.object.position;i.copy(_).sub(t.target);let F=i.length();F*=Math.tan(t.object.fov/2*Math.PI/180),Q(2*y*F/k.clientHeight,t.object.matrix),st(2*C*F/k.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(Q(y*(t.object.right-t.object.left)/t.object.zoom/k.clientWidth,t.object.matrix),st(C*(t.object.top-t.object.bottom)/t.object.zoom/k.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Rt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p/=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function Jt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p*=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function St(i,u){if(!t.zoomToCursor)return;N=!0;const y=t.domElement.getBoundingClientRect(),C=i-y.left,k=u-y.top,_=y.width,F=y.height;j.x=C/_*2-1,j.y=-(k/F)*2+1,O.set(j.x,j.y,1).unproject(t.object).sub(t.object.position).normalize()}function Nt(i){return Math.max(t.minDistance,Math.min(t.maxDistance,i))}function vt(i){g.set(i.clientX,i.clientY)}function en(i){St(i.clientX,i.clientX),b.set(i.clientX,i.clientY)}function te(i){A.set(i.clientX,i.clientY)}function nn(i){x.set(i.clientX,i.clientY),P.subVectors(x,g).multiplyScalar(t.rotateSpeed);const u=t.domElement;Z(2*Math.PI*P.x/u.clientHeight),$(2*Math.PI*P.y/u.clientHeight),g.copy(x),t.update()}function on(i){d.set(i.clientX,i.clientY),M.subVectors(d,b),M.y>0?Rt(q(M.y)):M.y<0&&Jt(q(M.y)),b.copy(d),t.update()}function sn(i){D.set(i.clientX,i.clientY),E.subVectors(D,A).multiplyScalar(t.panSpeed),J(E.x,E.y),A.copy(D),t.update()}function rn(i){St(i.clientX,i.clientY),i.deltaY<0?Jt(q(i.deltaY)):i.deltaY>0&&Rt(q(i.deltaY)),t.update()}function an(i){let u=!1;switch(i.code){case t.keys.UP:i.ctrlKey||i.metaKey||i.shiftKey?$(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(0,t.keyPanSpeed),u=!0;break;case t.keys.BOTTOM:i.ctrlKey||i.metaKey||i.shiftKey?$(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(0,-t.keyPanSpeed),u=!0;break;case t.keys.LEFT:i.ctrlKey||i.metaKey||i.shiftKey?Z(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(t.keyPanSpeed,0),u=!0;break;case t.keys.RIGHT:i.ctrlKey||i.metaKey||i.shiftKey?Z(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(-t.keyPanSpeed,0),u=!0;break}u&&(i.preventDefault(),t.update())}function ee(i){if(I.length===1)g.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);g.set(y,C)}}function ne(i){if(I.length===1)A.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);A.set(y,C)}}function oe(i){const u=v(i),y=i.pageX-u.x,C=i.pageY-u.y,k=Math.sqrt(y*y+C*C);b.set(0,k)}function cn(i){t.enableZoom&&oe(i),t.enablePan&&ne(i)}function ln(i){t.enableZoom&&oe(i),t.enableRotate&&ee(i)}function se(i){if(I.length==1)x.set(i.pageX,i.pageY);else{const y=v(i),C=.5*(i.pageX+y.x),k=.5*(i.pageY+y.y);x.set(C,k)}P.subVectors(x,g).multiplyScalar(t.rotateSpeed);const u=t.domElement;Z(2*Math.PI*P.x/u.clientHeight),$(2*Math.PI*P.y/u.clientHeight),g.copy(x)}function ie(i){if(I.length===1)D.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);D.set(y,C)}E.subVectors(D,A).multiplyScalar(t.panSpeed),J(E.x,E.y),A.copy(D)}function re(i){const u=v(i),y=i.pageX-u.x,C=i.pageY-u.y,k=Math.sqrt(y*y+C*C);d.set(0,k),M.set(0,Math.pow(d.y/b.y,t.zoomSpeed)),Rt(M.y),b.copy(d);const _=(i.pageX+u.x)*.5,F=(i.pageY+u.y)*.5;St(_,F)}function hn(i){t.enableZoom&&re(i),t.enablePan&&ie(i)}function pn(i){t.enableZoom&&re(i),t.enableRotate&&se(i)}function ae(i){t.enabled!==!1&&(I.length===0&&(t.domElement.setPointerCapture(i.pointerId),t.domElement.addEventListener("pointermove",Lt),t.domElement.addEventListener("pointerup",it)),yn(i),i.pointerType==="touch"?he(i):un(i))}function Lt(i){t.enabled!==!1&&(i.pointerType==="touch"?bn(i):mn(i))}function it(i){switch(gn(i),I.length){case 0:t.domElement.releasePointerCapture(i.pointerId),t.domElement.removeEventListener("pointermove",Lt),t.domElement.removeEventListener("pointerup",it),t.dispatchEvent(we),c=o.NONE;break;case 1:const u=I[0],y=K[u];he({pointerId:u,pageX:y.x,pageY:y.y});break}}function un(i){let u;switch(i.button){case 0:u=t.mouseButtons.LEFT;break;case 1:u=t.mouseButtons.MIDDLE;break;case 2:u=t.mouseButtons.RIGHT;break;default:u=-1}switch(u){case tt.DOLLY:if(t.enableZoom===!1)return;en(i),c=o.DOLLY;break;case tt.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enablePan===!1)return;te(i),c=o.PAN}else{if(t.enableRotate===!1)return;vt(i),c=o.ROTATE}break;case tt.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enableRotate===!1)return;vt(i),c=o.ROTATE}else{if(t.enablePan===!1)return;te(i),c=o.PAN}break;default:c=o.NONE}c!==o.NONE&&t.dispatchEvent(Vt)}function mn(i){switch(c){case o.ROTATE:if(t.enableRotate===!1)return;nn(i);break;case o.DOLLY:if(t.enableZoom===!1)return;on(i);break;case o.PAN:if(t.enablePan===!1)return;sn(i);break}}function ce(i){t.enabled===!1||t.enableZoom===!1||c!==o.NONE||(i.preventDefault(),t.dispatchEvent(Vt),rn(fn(i)),t.dispatchEvent(we))}function fn(i){const u=i.deltaMode,y={clientX:i.clientX,clientY:i.clientY,deltaY:i.deltaY};switch(u){case 1:y.deltaY*=16;break;case 2:y.deltaY*=100;break}return i.ctrlKey&&!G&&(y.deltaY*=10),y}function dn(i){i.key==="Control"&&(G=!0,t.domElement.getRootNode().addEventListener("keyup",le,{passive:!0,capture:!0}))}function le(i){i.key==="Control"&&(G=!1,t.domElement.getRootNode().removeEventListener("keyup",le,{passive:!0,capture:!0}))}function kt(i){t.enabled===!1||t.enablePan===!1||an(i)}function he(i){switch(ue(i),I.length){case 1:switch(t.touches.ONE){case et.ROTATE:if(t.enableRotate===!1)return;ee(i),c=o.TOUCH_ROTATE;break;case et.PAN:if(t.enablePan===!1)return;ne(i),c=o.TOUCH_PAN;break;default:c=o.NONE}break;case 2:switch(t.touches.TWO){case et.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;cn(i),c=o.TOUCH_DOLLY_PAN;break;case et.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ln(i),c=o.TOUCH_DOLLY_ROTATE;break;default:c=o.NONE}break;default:c=o.NONE}c!==o.NONE&&t.dispatchEvent(Vt)}function bn(i){switch(ue(i),c){case o.TOUCH_ROTATE:if(t.enableRotate===!1)return;se(i),t.update();break;case o.TOUCH_PAN:if(t.enablePan===!1)return;ie(i),t.update();break;case o.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;hn(i),t.update();break;case o.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;pn(i),t.update();break;default:c=o.NONE}}function pe(i){t.enabled!==!1&&i.preventDefault()}function yn(i){I.push(i.pointerId)}function gn(i){delete K[i.pointerId];for(let u=0;u<I.length;u++)if(I[u]==i.pointerId){I.splice(u,1);return}}function ue(i){let u=K[i.pointerId];u===void 0&&(u=new V,K[i.pointerId]=u),u.set(i.pageX,i.pageY)}function v(i){const u=i.pointerId===I[0]?I[1]:I[0];return K[u]}t.domElement.addEventListener("contextmenu",pe),t.domElement.addEventListener("pointerdown",ae),t.domElement.addEventListener("pointercancel",it),t.domElement.addEventListener("wheel",ce,{passive:!1}),t.domElement.getRootNode().addEventListener("keydown",dn,{passive:!0,capture:!0}),this.update()}}const l=8;let wt;const Tn=new Uint8Array(16);function An(){if(!wt&&(wt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wt(Tn)}const L=[];for(let n=0;n<256;++n)L.push((n+256).toString(16).slice(1));function Dn(n,s=0){return L[n[s+0]]+L[n[s+1]]+L[n[s+2]]+L[n[s+3]]+"-"+L[n[s+4]]+L[n[s+5]]+"-"+L[n[s+6]]+L[n[s+7]]+"-"+L[n[s+8]]+L[n[s+9]]+"-"+L[n[s+10]]+L[n[s+11]]+L[n[s+12]]+L[n[s+13]]+L[n[s+14]]+L[n[s+15]]}const In=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pe={randomUUID:In};function Rn(n,s,e){if(Pe.randomUUID&&!s&&!n)return Pe.randomUUID();n=n||{};const t=n.random||(n.rng||An)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,s){e=e||0;for(let o=0;o<16;++o)s[e+o]=t[o];return s}return Dn(t)}class Ct extends On{constructor(...e){super();w(this,"key");w(this,"movable",!1);w(this,"mirrorComponent");w(this,"color");w(this,"objectType","Component");this.key=Rn(),this.generateElement(...e),this.mirrorComponent=null}setName(e){return this.name=e,this}}const T=(n,s=1,e=!1)=>{let t=1;return e&&(t=0),n*l+l*(s||1)/2*t},Sn=(n,s=1)=>Math.round((n-l*(s||1)/2)/l),Y=(n,s,e)=>{const t=Array.from(n);return t[e]=2*s[e]-t[e]-1,t},Et=(n,s)=>!(n.max.x<=s.min.x||n.min.x>=s.max.x||n.max.y<=s.min.y||n.min.y>=s.max.y||n.max.z<=s.min.z||n.min.z>=s.max.z);function Le(n,s){var e={};for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&s.indexOf(t)<0&&(e[t]=n[t]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(n);o<t.length;o++)s.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(n,t[o])&&(e[t[o]]=n[t[o]]);return e}var Ee=function(){};const Ht=(n,s,e)=>Math.min(Math.max(e,n),s),zt=.001,Nn=.01,Ln=10,kn=.05,Fn=1;function Vn({duration:n=800,bounce:s=.25,velocity:e=0,mass:t=1}){let o,c,a=1-s;a=Ht(kn,Fn,a),n=Ht(Nn,Ln,n/1e3),a<1?(o=p=>{const f=p*a,g=f*n,x=f-e,P=Kt(p,a),A=Math.exp(-g);return zt-x/P*A},c=p=>{const g=p*a*n,x=g*e+e,P=Math.pow(a,2)*Math.pow(p,2)*n,A=Math.exp(-g),D=Kt(Math.pow(p,2),a);return(-o(p)+zt>0?-1:1)*((x-P)*A)/D}):(o=p=>{const f=Math.exp(-p*n),g=(p-e)*n+1;return-zt+f*g},c=p=>{const f=Math.exp(-p*n),g=(e-p)*(n*n);return f*g});const r=5/n,h=Un(o,c,r);if(n=n*1e3,isNaN(h))return{stiffness:100,damping:10,duration:n};{const p=Math.pow(h,2)*t;return{stiffness:p,damping:a*2*Math.sqrt(t*p),duration:n}}}const zn=12;function Un(n,s,e){let t=e;for(let o=1;o<zn;o++)t=t-n(t)/s(t);return t}function Kt(n,s){return n*Math.sqrt(1-s*s)}const Yn=["duration","bounce"],Hn=["stiffness","damping","mass"];function Oe(n,s){return s.some(e=>n[e]!==void 0)}function Kn(n){let s=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},n);if(!Oe(n,Hn)&&Oe(n,Yn)){const e=Vn(n);s=Object.assign(Object.assign(Object.assign({},s),e),{velocity:0,mass:1}),s.isResolvedFromDuration=!0}return s}function Gt(n){var{from:s=0,to:e=1,restSpeed:t=2,restDelta:o}=n,c=Le(n,["from","to","restSpeed","restDelta"]);const a={done:!1,value:s};let{stiffness:r,damping:h,mass:p,velocity:f,duration:g,isResolvedFromDuration:x}=Kn(c),P=je,A=je;function D(){const E=f?-(f/1e3):0,b=e-s,d=h/(2*Math.sqrt(r*p)),M=Math.sqrt(r/p)/1e3;if(o===void 0&&(o=Math.min(Math.abs(e-s)/100,.4)),d<1){const O=Kt(M,d);P=j=>{const N=Math.exp(-d*M*j);return e-N*((E+d*M*b)/O*Math.sin(O*j)+b*Math.cos(O*j))},A=j=>{const N=Math.exp(-d*M*j);return d*M*N*(Math.sin(O*j)*(E+d*M*b)/O+b*Math.cos(O*j))-N*(Math.cos(O*j)*(E+d*M*b)-O*b*Math.sin(O*j))}}else if(d===1)P=O=>e-Math.exp(-M*O)*(b+(E+M*b)*O);else{const O=M*Math.sqrt(d*d-1);P=j=>{const N=Math.exp(-d*M*j),I=Math.min(O*j,300);return e-N*((E+d*M*b)*Math.sinh(I)+O*b*Math.cosh(I))/O}}}return D(),{next:E=>{const b=P(E);if(x)a.done=E>=g;else{const d=A(E)*1e3,M=Math.abs(d)<=t,O=Math.abs(e-b)<=o;a.done=M&&O}return a.value=a.done?e:b,a},flipTarget:()=>{f=-f,[s,e]=[e,s],D()}}}Gt.needsInterpolation=(n,s)=>typeof n=="string"||typeof s=="string";const je=n=>0,ke=(n,s,e)=>{const t=s-n;return t===0?1:(e-n)/t},qt=(n,s,e)=>-e*n+e*s+n,Fe=(n,s)=>e=>Math.max(Math.min(e,s),n),lt=n=>n%1?Number(n.toFixed(5)):n,Ot=/(-)?([\d]*\.?[\d])+/g,_t=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,_n=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function ft(n){return typeof n=="string"}const Tt={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Ve=Object.assign(Object.assign({},Tt),{transform:Fe(0,1)});Object.assign(Object.assign({},Tt),{default:1});const Bn=n=>({test:s=>ft(s)&&s.endsWith(n)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${n}`}),ht=Bn("%");Object.assign(Object.assign({},ht),{parse:n=>ht.parse(n)/100,transform:n=>ht.transform(n*100)});const $t=(n,s)=>e=>!!(ft(e)&&_n.test(e)&&e.startsWith(n)||s&&Object.prototype.hasOwnProperty.call(e,s)),ze=(n,s,e)=>t=>{if(!ft(t))return t;const[o,c,a,r]=t.match(Ot);return{[n]:parseFloat(o),[s]:parseFloat(c),[e]:parseFloat(a),alpha:r!==void 0?parseFloat(r):1}},W={test:$t("hsl","hue"),parse:ze("hue","saturation","lightness"),transform:({hue:n,saturation:s,lightness:e,alpha:t=1})=>"hsla("+Math.round(n)+", "+ht.transform(lt(s))+", "+ht.transform(lt(e))+", "+lt(Ve.transform(t))+")"},Xn=Fe(0,255),Ut=Object.assign(Object.assign({},Tt),{transform:n=>Math.round(Xn(n))}),X={test:$t("rgb","red"),parse:ze("red","green","blue"),transform:({red:n,green:s,blue:e,alpha:t=1})=>"rgba("+Ut.transform(n)+", "+Ut.transform(s)+", "+Ut.transform(e)+", "+lt(Ve.transform(t))+")"};function Zn(n){let s="",e="",t="",o="";return n.length>5?(s=n.substr(1,2),e=n.substr(3,2),t=n.substr(5,2),o=n.substr(7,2)):(s=n.substr(1,1),e=n.substr(2,1),t=n.substr(3,1),o=n.substr(4,1),s+=s,e+=e,t+=t,o+=o),{red:parseInt(s,16),green:parseInt(e,16),blue:parseInt(t,16),alpha:o?parseInt(o,16)/255:1}}const Bt={test:$t("#"),parse:Zn,transform:X.transform},At={test:n=>X.test(n)||Bt.test(n)||W.test(n),parse:n=>X.test(n)?X.parse(n):W.test(n)?W.parse(n):Bt.parse(n),transform:n=>ft(n)?n:n.hasOwnProperty("red")?X.transform(n):W.transform(n)},Ue="${c}",Ye="${n}";function Wn(n){var s,e,t,o;return isNaN(n)&&ft(n)&&((e=(s=n.match(Ot))===null||s===void 0?void 0:s.length)!==null&&e!==void 0?e:0)+((o=(t=n.match(_t))===null||t===void 0?void 0:t.length)!==null&&o!==void 0?o:0)>0}function He(n){typeof n=="number"&&(n=`${n}`);const s=[];let e=0;const t=n.match(_t);t&&(e=t.length,n=n.replace(_t,Ue),s.push(...t.map(At.parse)));const o=n.match(Ot);return o&&(n=n.replace(Ot,Ye),s.push(...o.map(Tt.parse))),{values:s,numColors:e,tokenised:n}}function Ke(n){return He(n).values}function _e(n){const{values:s,numColors:e,tokenised:t}=He(n),o=s.length;return c=>{let a=t;for(let r=0;r<o;r++)a=a.replace(r<e?Ue:Ye,r<e?At.transform(c[r]):lt(c[r]));return a}}const Gn=n=>typeof n=="number"?0:n;function qn(n){const s=Ke(n);return _e(n)(s.map(Gn))}const Be={test:Wn,parse:Ke,createTransformer:_e,getAnimatableNone:qn};function Yt(n,s,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?n+(s-n)*6*e:e<1/2?s:e<2/3?n+(s-n)*(2/3-e)*6:n}function Ce({hue:n,saturation:s,lightness:e,alpha:t}){n/=360,s/=100,e/=100;let o=0,c=0,a=0;if(!s)o=c=a=e;else{const r=e<.5?e*(1+s):e+s-e*s,h=2*e-r;o=Yt(h,r,n+1/3),c=Yt(h,r,n),a=Yt(h,r,n-1/3)}return{red:Math.round(o*255),green:Math.round(c*255),blue:Math.round(a*255),alpha:t}}const $n=(n,s,e)=>{const t=n*n,o=s*s;return Math.sqrt(Math.max(0,e*(o-t)+t))},Qn=[Bt,X,W],Te=n=>Qn.find(s=>s.test(n)),Xe=(n,s)=>{let e=Te(n),t=Te(s),o=e.parse(n),c=t.parse(s);e===W&&(o=Ce(o),e=X),t===W&&(c=Ce(c),t=X);const a=Object.assign({},o);return r=>{for(const h in a)h!=="alpha"&&(a[h]=$n(o[h],c[h],r));return a.alpha=qt(o.alpha,c.alpha,r),e.transform(a)}},Jn=n=>typeof n=="number",vn=(n,s)=>e=>s(n(e)),Ze=(...n)=>n.reduce(vn);function We(n,s){return Jn(n)?e=>qt(n,s,e):At.test(n)?Xe(n,s):qe(n,s)}const Ge=(n,s)=>{const e=[...n],t=e.length,o=n.map((c,a)=>We(c,s[a]));return c=>{for(let a=0;a<t;a++)e[a]=o[a](c);return e}},to=(n,s)=>{const e=Object.assign(Object.assign({},n),s),t={};for(const o in e)n[o]!==void 0&&s[o]!==void 0&&(t[o]=We(n[o],s[o]));return o=>{for(const c in t)e[c]=t[c](o);return e}};function Ae(n){const s=Be.parse(n),e=s.length;let t=0,o=0,c=0;for(let a=0;a<e;a++)t||typeof s[a]=="number"?t++:s[a].hue!==void 0?c++:o++;return{parsed:s,numNumbers:t,numRGB:o,numHSL:c}}const qe=(n,s)=>{const e=Be.createTransformer(s),t=Ae(n),o=Ae(s);return t.numHSL===o.numHSL&&t.numRGB===o.numRGB&&t.numNumbers>=o.numNumbers?Ze(Ge(t.parsed,o.parsed),e):a=>`${a>0?s:n}`},eo=(n,s)=>e=>qt(n,s,e);function no(n){if(typeof n=="number")return eo;if(typeof n=="string")return At.test(n)?Xe:qe;if(Array.isArray(n))return Ge;if(typeof n=="object")return to}function oo(n,s,e){const t=[],o=e||no(n[0]),c=n.length-1;for(let a=0;a<c;a++){let r=o(n[a],n[a+1]);if(s){const h=Array.isArray(s)?s[a]:s;r=Ze(h,r)}t.push(r)}return t}function so([n,s],[e]){return t=>e(ke(n,s,t))}function io(n,s){const e=n.length,t=e-1;return o=>{let c=0,a=!1;if(o<=n[0]?a=!0:o>=n[t]&&(c=t-1,a=!0),!a){let h=1;for(;h<e&&!(n[h]>o||h===t);h++);c=h-1}const r=ke(n[c],n[c+1],o);return s[c](r)}}function $e(n,s,{clamp:e=!0,ease:t,mixer:o}={}){const c=n.length;Ee(c===s.length),Ee(!t||!Array.isArray(t)||t.length===c-1),n[0]>n[c-1]&&(n=[].concat(n),s=[].concat(s),n.reverse(),s.reverse());const a=oo(s,t,o),r=c===2?so(n,a):io(n,a);return e?h=>r(Ht(n[0],n[c-1],h)):r}const ro=n=>s=>s<=.5?n(2*s)/2:(2-n(2*(1-s)))/2,ao=n=>s=>Math.pow(s,n),co=n=>s=>s*s*((n+1)*s-n),lo=n=>{const s=co(n);return e=>(e*=2)<1?.5*s(e):.5*(2-Math.pow(2,-10*(e-1)))},ho=1.525,po=ao(2),uo=ro(po);lo(ho);function mo(n,s){return n.map(()=>s||uo).splice(0,n.length-1)}function fo(n){const s=n.length;return n.map((e,t)=>t!==0?t/(s-1):0)}function bo(n,s){return n.map(e=>e*s)}function Mt({from:n=0,to:s=1,ease:e,offset:t,duration:o=300}){const c={done:!1,value:n},a=Array.isArray(s)?s:[n,s],r=bo(t&&t.length===a.length?t:fo(a),o);function h(){return $e(r,a,{ease:Array.isArray(e)?e:mo(a,e)})}let p=h();return{next:f=>(c.value=p(f),c.done=f>=o,c),flipTarget:()=>{a.reverse(),p=h()}}}function yo({velocity:n=0,from:s=0,power:e=.8,timeConstant:t=350,restDelta:o=.5,modifyTarget:c}){const a={done:!1,value:s};let r=e*n;const h=s+r,p=c===void 0?h:c(h);return p!==h&&(r=p-s),{next:f=>{const g=-r*Math.exp(-f/t);return a.done=!(g>o||g<-o),a.value=a.done?p:p+g,a},flipTarget:()=>{}}}const De={keyframes:Mt,spring:Gt,decay:yo};function go(n){if(Array.isArray(n.to))return Mt;if(De[n.type])return De[n.type];const s=new Set(Object.keys(n));return s.has("ease")||s.has("duration")&&!s.has("dampingRatio")?Mt:s.has("dampingRatio")||s.has("stiffness")||s.has("mass")||s.has("damping")||s.has("restSpeed")||s.has("restDelta")?Gt:Mt}const Qe=1/60*1e3,xo=typeof performance<"u"?()=>performance.now():()=>Date.now(),Je=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(xo()),Qe);function wo(n){let s=[],e=[],t=0,o=!1,c=!1;const a=new WeakSet,r={schedule:(h,p=!1,f=!1)=>{const g=f&&o,x=g?s:e;return p&&a.add(h),x.indexOf(h)===-1&&(x.push(h),g&&o&&(t=s.length)),h},cancel:h=>{const p=e.indexOf(h);p!==-1&&e.splice(p,1),a.delete(h)},process:h=>{if(o){c=!0;return}if(o=!0,[s,e]=[e,s],e.length=0,t=s.length,t)for(let p=0;p<t;p++){const f=s[p];f(h),a.has(f)&&(r.schedule(f),n())}o=!1,c&&(c=!1,r.process(h))}};return r}const Mo=40;let Xt=!0,mt=!1,Zt=!1;const pt={delta:0,timestamp:0},dt=["read","update","preRender","render","postRender"],Dt=dt.reduce((n,s)=>(n[s]=wo(()=>mt=!0),n),{}),Po=dt.reduce((n,s)=>{const e=Dt[s];return n[s]=(t,o=!1,c=!1)=>(mt||jo(),e.schedule(t,o,c)),n},{}),Eo=dt.reduce((n,s)=>(n[s]=Dt[s].cancel,n),{});dt.reduce((n,s)=>(n[s]=()=>Dt[s].process(pt),n),{});const Oo=n=>Dt[n].process(pt),ve=n=>{mt=!1,pt.delta=Xt?Qe:Math.max(Math.min(n-pt.timestamp,Mo),1),pt.timestamp=n,Zt=!0,dt.forEach(Oo),Zt=!1,mt&&(Xt=!1,Je(ve))},jo=()=>{mt=!0,Xt=!0,Zt||Je(ve)},Co=Po;function tn(n,s,e=0){return n-s-e}function To(n,s,e=0,t=!0){return t?tn(s+-n,s,e):s-(n-s)+e}function Ao(n,s,e,t){return t?n>=s+e:n<=-e}const Do=n=>{const s=({delta:e})=>n(e);return{start:()=>Co.update(s,!0),stop:()=>Eo.update(s)}};function jt(n){var s,e,{from:t,autoplay:o=!0,driver:c=Do,elapsed:a=0,repeat:r=0,repeatType:h="loop",repeatDelay:p=0,onPlay:f,onStop:g,onComplete:x,onRepeat:P,onUpdate:A}=n,D=Le(n,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:E}=D,b,d=0,M=D.duration,O,j=!1,N=!0,I;const K=go(D);!((e=(s=K).needsInterpolation)===null||e===void 0)&&e.call(s,t,E)&&(I=$e([0,100],[t,E],{clamp:!1}),t=0,E=100);const G=K(Object.assign(Object.assign({},D),{from:t,to:E}));function It(){d++,h==="reverse"?(N=d%2===0,a=To(a,M,p,N)):(a=tn(a,M,p),h==="mirror"&&G.flipTarget()),j=!1,P&&P()}function q(){b.stop(),x&&x()}function Z(Q){if(N||(Q=-Q),a+=Q,!j){const st=G.next(Math.max(0,a));O=st.value,I&&(O=I(O)),j=N?st.done:a<=0}A==null||A(O),j&&(d===0&&(M??(M=a)),d<r?Ao(a,M,p,N)&&It():q())}function $(){f==null||f(),b=c(Z),b.start()}return o&&$(),{stop:()=>{g==null||g(),b.stop()}}}class Qt extends Ct{constructor(...e){super(...e);w(this,"pos");this.objectType="Cube",this.pos=e[0],this.color=(e==null?void 0:e[1])||"#54c8ff"}generateElement(...e){this.generateCube(e[0],e==null?void 0:e[1])}generateCube(e,t=5556479){const o=new ot(l,l,l),c=new Wt({color:t}),a=new ut(o,c);a.position.x=T(e[0],1),a.position.y=T(e[1],1),a.position.z=T(e[2],1),a.applyMatrix4(new Se().makeScale(1,1,1)),this.add(a)}setPos(e){this.pos=e,this.children.forEach(t=>{t.position.x=T(e[0],1),t.position.y=T(e[1],1),t.position.z=T(e[2],1)})}setPosAnimate(e){this.pos=e;const t=new m(T(e[0],1),T(e[1],1),T(e[2],1));jt({from:this.children[0].position,to:t,onUpdate:o=>{this.children[0].position.copy(o)}})}setColor(e){this.color=e;const t="#"+this.children[0].material.color.getHexString();jt({from:t,to:e,onUpdate:o=>{this.children[0].material.color.setStyle(o),this.mirrorComponent&&this.mirrorComponent.children[0].material.color.setStyle(o)}})}detechCollide(e){const t=this.children[0],o=new Pt().setFromObject(t);return Et(e,o)}}Qt.cnName="正方体";Qt.enName="Cube";const S=(n,s=1)=>n*l+l*(s||1)/2,Ie=(n,s=1)=>Math.round((n-l*(s||1)/2)/l);class Io extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"range");w(this,"mirrorInfo",{pos:[0,0,0],face:0});this.movable=!0,this.objectType="Drawbox",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[1,1,1],this.range=(e==null?void 0:e[2])||[[1],[1],[1]],this.color=(e==null?void 0:e[3])||"#ffe21f"}generateElement(...e){this.generateDrawbox(e[0],e[1],e[3])}generateDrawbox(e,t,o=16769567){const c=new ot(l*(t[0]||1),l*(t[1]||1),l*(t[2]||1)),a=new Wt({color:o}),r=new ut(c,a);r.position.x=S(e[0],t[0]),r.position.y=S(e[1],t[1]),r.position.z=S(e[2],t[2]),this.add(r)}setPos(e){if(this.pos=e,this.children.forEach(t=>{t.position.x=S(e[0],this.len[0]),t.position.y=S(e[1],this.len[1]),t.position.z=S(e[2],this.len[2])}),this.mirrorComponent){const t=Y(this.pos,this.mirrorInfo.pos,this.mirrorInfo.face);t[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(t)}}setPosAnimate(e){this.pos=e;const t=new m(S(e[0],this.len[0]),S(e[1],this.len[1]),S(e[2],this.len[2]));jt({from:this.children[0].position,to:t,onUpdate:o=>{this.children[0].position.copy(o)}})}setSize(e){this.len=e,this.children.forEach(t=>{const o=t;o==null||o.geometry.dispose(),o.geometry=new ot(l*(e[0]||1),l*(e[1]||1),l*(e[2]||1)),o.position.x=S(this.pos[0],e[0]),o.position.y=S(this.pos[1],e[1]),o.position.z=S(this.pos[2],e[2])})}setRange(e){this.range=e}setColor(e){this.color=e,this.children.forEach(t=>{var o;(o=t==null?void 0:t.material)==null||o.color.setStyle(e)}),this.mirrorComponent&&this.mirrorComponent.children.forEach(t=>{var o;(o=t==null?void 0:t.material)==null||o.color.setStyle(e)})}onControlDrag(e){const t=e.object.position.toArray();for(let o=0;o<3;++o)this.range[o].length===2&&this.range[o][0]<this.range[o][1]?(t[o]<=S(this.range[o][0],this.len[o])&&(t[o]=S(this.range[o][0],this.len[o])),t[o]>=S(this.range[o][1],this.len[o])&&(t[o]=S(this.range[o][1],this.len[o]))):t[o]=S(this.pos[o],this.len[o]),this.pos[o]=Ie(t[o],this.len[o]);if(e.object.position.fromArray(t),this.mirrorComponent){let o=[0,0,0];for(let c=0;c<o.length;++c)o[c]=(t[c]-l*(this.len[c]||1)/2)/l;o=Y(o,this.mirrorInfo.pos,this.mirrorInfo.face),o[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(o)}}onControlDragEnd(e){const t=e.object.position.toArray();for(let o=0;o<3;++o)this.pos[o]=Ie(t[o],this.len[o]),t[o]=S(this.pos[o],this.len[o]);if(e.object.position.fromArray(t),this.mirrorComponent){const o=Y(this.pos,this.mirrorInfo.pos,this.mirrorInfo.face);o[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(o)}}onDragEnd(){}detechCollide(e){const t=this.children[0],o=new Pt().setFromObject(t);return Et(e,o)}}const R=(n,s=1)=>(n||0)*l+l*(s||1)/2;class Ro extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"startVector",null);w(this,"mirrorInfo",{face:0});w(this,"plane");w(this,"angle");w(this,"face");w(this,"enabled",!0);w(this,"direction",1);w(this,"angleAccumulate",0);this.movable=!0,this.objectType="Rotator",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[4,4],this.angle=(e==null?void 0:e[3])||0,this.face=(e==null?void 0:e[5])||["+x","+y"],this.direction=(e==null?void 0:e[4])||0,this.plane=new H(new m(0,1,0),-R(this.pos[1],1)),this.color=(e==null?void 0:e[2])||"#fb8888",this.setFace(this.face),this.setDirection(this.direction)}setFace(e){var g;this.face=e;const t=this.children[0],o=this.children[1];function c(x,P,A){x.geometry.dispose();const E={x:[P,1,1],y:[1,P,1],z:[1,1,P]}[A];x.geometry=new ot(...E.map(b=>l*b))}const a=e[0][1];c(t,this.len[0],a);const r=["x","y","z"];for(const x of r)if(x===a){const P=e[0][0]==="+"?-.5:.5-this.len[0];t.position[x]=R(P,this.len[0])}else t.position[x]=R(-1/2);const h=e[1][1];c(o,this.len[1],h);for(const x of r)if(x===h){const P=e[1][0]==="+"?-.5:.5-this.len[1];o.position[x]=R(P,this.len[1])}else o.position[x]=R(-1/2);function p(x){return x==="+"?"-":"+"}const f=["x","y","z"][this.mirrorInfo.face];(g=this.mirrorComponent)==null||g.setFace([(e[0][1]!==f?e[0][0]:p(e[0][0]))+e[0][1],(e[1][1]!==f?e[1][0]:p(e[1][0]))+e[1][1]])}setDirection(e){var t;this.direction=(Math.floor(e)||0)%3,this.setAngle(this.angle),this.plane=new H(new m(+(this.direction===0),+(this.direction===1),+(this.direction===2)),-R(this.pos[this.direction],1)),(t=this.mirrorComponent)==null||t.setDirection(this.direction)}setAngle(e){var o;this.angle=((Math.floor(e)||0)%4+4)%4;const t=[0,0,0];t[this.direction]=Math.PI*e/2,this.rotation.x=t[0],this.rotation.y=t[1],this.rotation.z=t[2],(o=this.mirrorComponent)==null||o.setAngle(this.angle*(this.mirrorInfo.face===this.direction?1:-1))}setPos(e){this.pos=e,this.position.set(l*(e[0]+1/2),l*(e[1]+1/2),l*(e[2]+1/2))}setPosAnimate(e){this.pos=e;const t=new m(l*(e[0]+1/2),l*(e[1]+1/2),l*(e[2]+1/2));jt({from:this.position,to:t,onUpdate:o=>{this.position.copy(o)}})}setSize(e){var t;this.len=e,this.setFace(this.face),(t=this.mirrorComponent)==null||t.setSize([this.len[0],this.len[1]])}setColor(e){this.color=e,this.children.forEach(t=>{var o;(o=t==null?void 0:t.material)==null||o.color.setStyle(e)}),this.mirrorComponent&&this.mirrorComponent.children.forEach(t=>{var o;(o=t==null?void 0:t.material)==null||o.color.setStyle(e)})}generateElement(...e){this.generateDrawbox(e[0],e[1],e[2])}generateDrawbox(e,t,o=16484488){const c=new ot(l*t[0],l,l),a=new Wt({color:o}),r=new ut(c,a);r.position.x=R(-1/2,t[0]),r.position.y=R(-1/2),r.position.z=R(-1/2);const h=new ot(l,l,l*t[1]),p=new ut(h,a);p.position.x=R(-1/2),p.position.y=R(-1/2),p.position.z=R(-1/2,t[1]),this.add(r),this.add(p),this.position.set(l*(e[0]+1/2),l*(e[1]+1/2),l*(e[2]+1/2))}onDragStart(e){if(!this.enabled)return;this.angleAccumulate=this.angle*Math.PI/2;const t=new m;e.ray.intersectPlane(this.plane,t),this.startVector=t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])})}onDrag(e){var a;if(!this.enabled||this.startVector===null)return;const t=new m;e.ray.intersectPlane(this.plane,t),t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])});const o=new m;o.crossVectors(this.startVector,t);let c=((a=this.startVector)==null?void 0:a.angleTo(t))||0;this.startVector=t,this.position.set(l/2,l/2,l/2),c*=this.direction===0&&o.x<0||this.direction===1&&o.y<0||this.direction===2&&o.z<0?-1:1,this.angleAccumulate+=c,this.angleAccumulate=(this.angleAccumulate%(Math.PI*2)+Math.PI*2)%(Math.PI*2),this.rotation.fromArray([0,1,2].map(r=>this.angleAccumulate*+(r===this.direction))),this.position.set(l*(this.pos[0]+1/2),l*(this.pos[1]+1/2),l*(this.pos[2]+1/2)),this.mirrorComponent&&(this.mirrorComponent.position.set(l/2,l/2,l/2),this.mirrorComponent.rotation.fromArray([0,1,2].map(r=>this.angleAccumulate*+(r===this.direction)*(this.mirrorInfo.face===this.direction?1:-1))),this.mirrorComponent.position.set(l*(this.mirrorComponent.pos[0]+1/2),l*(this.mirrorComponent.pos[1]+1/2),l*(this.mirrorComponent.pos[2]+1/2)))}onDragEnd(e){var a,r;if(!this.enabled||this.startVector===null)return;const t=new m;e.ray.intersectPlane(this.plane,t),t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])});const o=new m;o.crossVectors(this.startVector,t);let c=((a=this.startVector)==null?void 0:a.angleTo(t))||0;this.startVector=t,this.position.set(-l/2,-l/2,-l/2),c*=this.direction===0&&o.x<0||this.direction===1&&o.y<0||this.direction===2&&o.z<0?-1:1,this.angleAccumulate+=c,this.angle=Math.round(this.angleAccumulate*2/Math.PI),this.angle=(this.angle%4+4)%4,this.angleAccumulate=this.angle*Math.PI/2,this.rotation.fromArray([0,1,2].map(h=>this.angleAccumulate*+(h===this.direction))),this.position.set(l*(this.pos[0]+1/2),l*(this.pos[1]+1/2),l*(this.pos[2]+1/2)),(r=this.mirrorComponent)==null||r.setAngle(this.angle*(this.mirrorInfo.face===this.direction?1:-1))}detechCollide(e){const t=this.children[0],o=this.children[0],c=new Pt().setFromObject(t),a=new Pt().setFromObject(o);return Et(e,c)||Et(e,a)}}class zo extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"range");w(this,"inMirrorObjs",[]);w(this,"realObjs",[]);w(this,"clippingPlanes",[]);this.movable=!0,this.objectType="Mirror",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[1,1,0],this.range=(e==null?void 0:e[2])||[[1],[1],[1]],this.color="0xffffff"}generateElement(...e){this.generateDrawbox(e[0],e[1])}generateDrawbox(e,t){const o=new be(l*(t[0]+t[2]),l*(t[1]||1)),c=new jn({color:16777215,transparent:!0,opacity:.5}),a=new ut(o,c);a.position.x=T(e[0],t[0],t[0]===0),a.position.y=T(e[1],t[1]),a.position.z=T(e[2],t[2],t[2]===0),t[0]===0&&(a.rotation.y=Math.PI/2),this.add(a)}updateMirrorCubePos(e){const t=e||this.parent,o=this.len[0]===0?0:2,c=["x","y","z"][o];function a(r){return r==="+"?"-":"+"}this.realObjs.forEach(r=>{let h,p;if(r.mirrorComponent)switch(r.objectType){case"Cube":r.mirrorComponent.setPos(Y(r.pos,this.pos,o));break;case"Drawbox":p=Y(r.pos,this.pos,o),p[o]-=r.len[o]-1,r.mirrorComponent.setPos(p),r.mirrorInfo={pos:this.pos,face:o};break;case"Rotator":r.mirrorComponent.setPos(Y(r.pos,this.pos,o)),r.mirrorComponent.setFace((r.face[0][0]==="-"?"+":"-")+r.face[0][1],(r.face[1][0]==="-"?"+":"-")+r.face[1][1]),r.mirrorComponent.setAngle(r.angle*(r.direction===o?1:-1)),r.mirrorInfo={face:o};break}else switch(r.objectType){case"Cube":h=new Qt(Y(r.pos,this.pos,o),r.color),r.mirrorComponent=h,this.inMirrorObjs.push(h),t.add(h);break;case"Rotator":h=new Ro(Y(r.pos,this.pos,o),[r.len[0],r.len[1]],r.color,r.angle*(r.direction===o?1:-1),r.direction,[(r.face[0][1]!==c?r.face[0][0]:a(r.face[0][0]))+r.face[0][1],(r.face[1][1]!==c?r.face[1][0]:a(r.face[1][0]))+r.face[1][1]]),h.enabled=!1,r.mirrorComponent=h,r.mirrorInfo={face:o},this.inMirrorObjs.push(h),t.add(h);break;case"Drawbox":p=Y(r.pos,this.pos,o),p[o]-=r.len[o]-1,h=new Io(p,r.len,r.color),r.mirrorComponent=h,r.mirrorInfo={pos:this.pos,face:o},this.inMirrorObjs.push(h),t.add(h);break}})}setPos(e){this.pos=e,this.children.forEach(t=>{const o=t;o.position.x=T(e[0],this.len[0],this.len[0]===0),o.position.y=T(e[1],this.len[1]),o.position.z=T(e[2],this.len[2],this.len[2]===0)}),this.updateMirrorCubePos(),this.handleObjectVisibility()}setSize(e){this.len=e,this.children.forEach(t=>{const o=t;o.geometry&&(o.geometry.dispose(),o.geometry=new be(l*(e[0]+e[2]),l*(e[1]||1))),e[0]===0&&(o.rotation.y=Math.PI/2),o.position.x=T(this.pos[0],e[0],e[0]===0),o.position.y=T(this.pos[1],e[1]),o.position.z=T(this.pos[2],e[2],e[2]===0)}),this.updateMirrorCubePos(),this.handleObjectVisibility()}setRange(e){this.range=e}handleObjectVisibility(){const e=this.len[0]===0?0:2,t=this.children[0],o=e===2?(t.position.x-l*this.len[0]/2)/l:(t.position.z-l*this.len[2]/2)/l,c=o+this.len[0]+this.len[2],a=(t.position.y-l*this.len[1]/2)/l,r=a+this.len[1];this.clippingPlanes=[new H().setFromNormalAndCoplanarPoint(e===2?new m(0,0,-1):new m(-1,0,0),e===2?new m(0,0,this.pos[2]*l):new m(this.pos[0]*l,0,0)),new H().setFromNormalAndCoplanarPoint(e===2?new m(1,0,-1):new m(-1,0,1),e===2?new m(o*l/2,0,this.pos[2]*l/2):new m(this.pos[0]*l/2,0,o*l/2)),new H().setFromNormalAndCoplanarPoint(e===2?new m(-1,0,1):new m(1,0,-1),e===2?new m(c*l/2,0,this.pos[2]*l/2):new m(this.pos[0]*l/2,0,c*l/2)),new H().setFromNormalAndCoplanarPoint(e===2?new m(0,-1,1):new m(1,-1,0),e===2?new m(0,r*l/2,this.pos[2]*l/2):new m(this.pos[0]*l/2,r*l/2,0)),new H().setFromNormalAndCoplanarPoint(e===2?new m(0,1,-1):new m(-1,1,0),e===2?new m(0,a*l/2,this.pos[2]*l/2):new m(this.pos[0]*l/2,a*l/2,0))],this.inMirrorObjs.forEach(p=>{p.children.forEach(f=>{f.material.clippingPlanes=this.clippingPlanes,f.material.clipIntersection=!1})});const h=[];for(const p of this.clippingPlanes)h.push(p.clone().negate());this.realObjs.forEach(p=>{p.children.forEach(f=>{f.material.clippingPlanes=h,f.material.clipIntersection=!0})})}onControlDrag(e){const t=e.object.position.toArray();for(let o=0;o<3;++o)this.range[o].length===2&&this.range[o][0]<this.range[o][1]?(t[o]<=T(this.range[o][0],this.len[o])&&(t[o]=T(this.range[o][0],this.len[o],this.len[o]===0)),t[o]>=T(this.range[o][1],this.len[o])&&(t[o]=T(this.range[o][1],this.len[o],this.len[o]===0))):t[o]=T(this.pos[o],this.len[o],this.len[o]===0);e.object.position.fromArray(t),this.handleObjectVisibility()}onControlDragEnd(e){const t=e.object.position.toArray();for(let o=0;o<3;++o)this.pos[o]=Sn(t[o],this.len[o]),t[o]=T(this.pos[o],this.len[o],this.len[o]===0);e.object.position.fromArray(t),this.handleObjectVisibility()}onDragEnd(){}setupMirrorCubes(e,t){this.realObjs=e,this.updateMirrorCubePos(t),this.handleObjectVisibility()}dispose(e){const t=e||this.parent;this.inMirrorObjs.forEach(o=>{o.geometry&&o.geometry.dispose(),t.remove(o)}),this.inMirrorObjs=[],this.realObjs.forEach(o=>{o.mirrorComponent&&(o.mirrorComponent=void 0),o.children.forEach(c=>{c.material.clippingPlanes=null})}),this.children.forEach(o=>{o.geometry&&o.geometry.dispose()})}detechCollide(e){return!1}}class Uo{constructor(s){w(this,"raycaster");w(this,"allObjs");w(this,"pickedObject");w(this,"pickedObjectSavedColor",0);w(this,"pickedObjectPoint");this.raycaster=new Re,this.allObjs=s||[]}updateObjs(s){this.allObjs=s}pick(s,e,t){this.pickedObject&&(this.pickedObject=void 0),this.raycaster.setFromCamera(s,t);const o=this.raycaster.intersectObjects(this.allObjs,!0);o.length&&(this.pickedObject=o[0].object,this.pickedObjectPoint=o[0].point)}}export{Qt as C,Fo as D,zo as M,Vo as O,Uo as P,Ro as R,Io as a,jt as b,Sn as f,l as u};
