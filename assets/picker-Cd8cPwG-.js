var wn=Object.defineProperty;var Mn=(o,s,e)=>s in o?wn(o,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[s]=e;var w=(o,s,e)=>(Mn(o,typeof s!="symbol"?s+"":s,e),e);import{av as H,R as Re,p as V,V as m,c as Se,aw as Ne,ax as Pn,ay as tt,az as et,Q as fe,aA as de,a7 as En,a6 as On,B as ot,b as Wt,M as ut,aB as T,aq as Pt,aC as Et,aD as z,a as be,e as jn,o as Cn}from"./methods-CJAzLewp.js";import{u as h}from"./constants-BDoWXNhu.js";const nt=new H,B=new Re,ct=new V,ye=new m,gt=new m,Ft=new m,ge=new Se;class Vo extends Ne{constructor(s,e,t){super(),t.style.touchAction="none";let n=null,c=null;const a=[],r=this;function l(){t.addEventListener("pointermove",P),t.addEventListener("pointerdown",A),t.addEventListener("pointerup",D),t.addEventListener("pointerleave",D)}function p(){t.removeEventListener("pointermove",P),t.removeEventListener("pointerdown",A),t.removeEventListener("pointerup",D),t.removeEventListener("pointerleave",D),t.style.cursor=""}function f(){p()}function g(){return s}function x(){return B}function P(b){if(r.enabled!==!1){if(E(b),B.setFromCamera(ct,e),n){B.ray.intersectPlane(nt,gt)&&n.position.copy(gt.sub(ye).applyMatrix4(ge)),r.dispatchEvent({type:"drag",object:n});return}if(b.pointerType==="mouse"||b.pointerType==="pen")if(a.length=0,B.setFromCamera(ct,e),B.intersectObjects(s,r.recursive,a),a.length>0){const d=a[0].object;nt.setFromNormalAndCoplanarPoint(e.getWorldDirection(nt.normal),Ft.setFromMatrixPosition(d.matrixWorld)),c!==d&&c!==null&&(r.dispatchEvent({type:"hoveroff",object:c}),t.style.cursor="auto",c=null),c!==d&&(r.dispatchEvent({type:"hoveron",object:d}),t.style.cursor="pointer",c=d)}else c!==null&&(r.dispatchEvent({type:"hoveroff",object:c}),t.style.cursor="auto",c=null)}}function A(b){r.enabled!==!1&&(E(b),a.length=0,B.setFromCamera(ct,e),B.intersectObjects(s,r.recursive,a),a.length>0&&(n=r.transformGroup===!0?s[0]:a[0].object,nt.setFromNormalAndCoplanarPoint(e.getWorldDirection(nt.normal),Ft.setFromMatrixPosition(n.matrixWorld)),B.ray.intersectPlane(nt,gt)&&(ge.copy(n.parent.matrixWorld).invert(),ye.copy(gt).sub(Ft.setFromMatrixPosition(n.matrixWorld))),t.style.cursor="move",r.dispatchEvent({type:"dragstart",object:n})))}function D(){r.enabled!==!1&&(n&&(r.dispatchEvent({type:"dragend",object:n}),n=null),t.style.cursor=c?"pointer":"auto")}function E(b){const d=t.getBoundingClientRect();ct.x=(b.clientX-d.left)/d.width*2-1,ct.y=-(b.clientY-d.top)/d.height*2+1}l(),this.enabled=!0,this.recursive=!0,this.transformGroup=!1,this.activate=l,this.deactivate=p,this.dispose=f,this.getObjects=g,this.getRaycaster=x}}const xe={type:"change"},Vt={type:"start"},we={type:"end"},xt=new Pn,Me=new H,Tn=Math.cos(70*En.DEG2RAD);class Uo extends Ne{constructor(s,e){super(),this.object=s,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new m,this.cursor=new m,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:tt.ROTATE,MIDDLE:tt.DOLLY,RIGHT:tt.PAN},this.touches={ONE:et.ROTATE,TWO:et.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return r.phi},this.getAzimuthalAngle=function(){return r.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(i){i.addEventListener("keydown",kt),this._domElementKeyEvents=i},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",kt),this._domElementKeyEvents=null},this.saveState=function(){t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=function(){t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(xe),t.update(),c=n.NONE},this.update=function(){const i=new m,u=new fe().setFromUnitVectors(s.up,new m(0,1,0)),y=u.clone().invert(),C=new m,k=new fe,_=new m,F=2*Math.PI;return function(xn=null){const me=t.object.position;i.copy(me).sub(t.target),i.applyQuaternion(u),r.setFromVector3(i),t.autoRotate&&c===n.NONE&&Z(It(xn)),t.enableDamping?(r.theta+=l.theta*t.dampingFactor,r.phi+=l.phi*t.dampingFactor):(r.theta+=l.theta,r.phi+=l.phi);let U=t.minAzimuthAngle,Y=t.maxAzimuthAngle;isFinite(U)&&isFinite(Y)&&(U<-Math.PI?U+=F:U>Math.PI&&(U-=F),Y<-Math.PI?Y+=F:Y>Math.PI&&(Y-=F),U<=Y?r.theta=Math.max(U,Math.min(Y,r.theta)):r.theta=r.theta>(U+Y)/2?Math.max(U,r.theta):Math.min(Y,r.theta)),r.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,r.phi)),r.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(f,t.dampingFactor):t.target.add(f),t.target.sub(t.cursor),t.target.clampLength(t.minTargetRadius,t.maxTargetRadius),t.target.add(t.cursor),t.zoomToCursor&&N||t.object.isOrthographicCamera?r.radius=Nt(r.radius):r.radius=Nt(r.radius*p),i.setFromSpherical(r),i.applyQuaternion(y),me.copy(t.target).add(i),t.object.lookAt(t.target),t.enableDamping===!0?(l.theta*=1-t.dampingFactor,l.phi*=1-t.dampingFactor,f.multiplyScalar(1-t.dampingFactor)):(l.set(0,0,0),f.set(0,0,0));let bt=!1;if(t.zoomToCursor&&N){let rt=null;if(t.object.isPerspectiveCamera){const at=i.length();rt=Nt(at*p);const yt=at-rt;t.object.position.addScaledVector(O,yt),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const at=new m(j.x,j.y,0);at.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix(),bt=!0;const yt=new m(j.x,j.y,0);yt.unproject(t.object),t.object.position.sub(yt).add(at),t.object.updateMatrixWorld(),rt=i.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;rt!==null&&(this.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(rt).add(t.object.position):(xt.origin.copy(t.object.position),xt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(xt.direction))<Tn?s.lookAt(t.target):(Me.setFromNormalAndCoplanarPoint(t.object.up,t.target),xt.intersectPlane(Me,t.target))))}else t.object.isOrthographicCamera&&(bt=p!==1,bt&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/p)),t.object.updateProjectionMatrix()));return p=1,N=!1,bt||C.distanceToSquared(t.object.position)>a||8*(1-k.dot(t.object.quaternion))>a||_.distanceToSquared(t.target)>0?(t.dispatchEvent(xe),C.copy(t.object.position),k.copy(t.object.quaternion),_.copy(t.target),!0):!1}}(),this.dispose=function(){t.domElement.removeEventListener("contextmenu",pe),t.domElement.removeEventListener("pointerdown",ae),t.domElement.removeEventListener("pointercancel",it),t.domElement.removeEventListener("wheel",ce),t.domElement.removeEventListener("pointermove",Lt),t.domElement.removeEventListener("pointerup",it),t._domElementKeyEvents!==null&&(t._domElementKeyEvents.removeEventListener("keydown",kt),t._domElementKeyEvents=null)};const t=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=n.NONE;const a=1e-6,r=new de,l=new de;let p=1;const f=new m,g=new V,x=new V,P=new V,A=new V,D=new V,E=new V,b=new V,d=new V,M=new V,O=new m,j=new V;let N=!1;const I=[],K={};let G=!1;function It(i){return i!==null?2*Math.PI/60*t.autoRotateSpeed*i:2*Math.PI/60/60*t.autoRotateSpeed}function q(i){const u=Math.abs(i*.01);return Math.pow(.95,t.zoomSpeed*u)}function Z(i){l.theta-=i}function $(i){l.phi-=i}const Q=function(){const i=new m;return function(y,C){i.setFromMatrixColumn(C,0),i.multiplyScalar(-y),f.add(i)}}(),st=function(){const i=new m;return function(y,C){t.screenSpacePanning===!0?i.setFromMatrixColumn(C,1):(i.setFromMatrixColumn(C,0),i.crossVectors(t.object.up,i)),i.multiplyScalar(y),f.add(i)}}(),J=function(){const i=new m;return function(y,C){const k=t.domElement;if(t.object.isPerspectiveCamera){const _=t.object.position;i.copy(_).sub(t.target);let F=i.length();F*=Math.tan(t.object.fov/2*Math.PI/180),Q(2*y*F/k.clientHeight,t.object.matrix),st(2*C*F/k.clientHeight,t.object.matrix)}else t.object.isOrthographicCamera?(Q(y*(t.object.right-t.object.left)/t.object.zoom/k.clientWidth,t.object.matrix),st(C*(t.object.top-t.object.bottom)/t.object.zoom/k.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}}();function Rt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p/=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function Jt(i){t.object.isPerspectiveCamera||t.object.isOrthographicCamera?p*=i:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function St(i,u){if(!t.zoomToCursor)return;N=!0;const y=t.domElement.getBoundingClientRect(),C=i-y.left,k=u-y.top,_=y.width,F=y.height;j.x=C/_*2-1,j.y=-(k/F)*2+1,O.set(j.x,j.y,1).unproject(t.object).sub(t.object.position).normalize()}function Nt(i){return Math.max(t.minDistance,Math.min(t.maxDistance,i))}function vt(i){g.set(i.clientX,i.clientY)}function en(i){St(i.clientX,i.clientX),b.set(i.clientX,i.clientY)}function te(i){A.set(i.clientX,i.clientY)}function nn(i){x.set(i.clientX,i.clientY),P.subVectors(x,g).multiplyScalar(t.rotateSpeed);const u=t.domElement;Z(2*Math.PI*P.x/u.clientHeight),$(2*Math.PI*P.y/u.clientHeight),g.copy(x),t.update()}function on(i){d.set(i.clientX,i.clientY),M.subVectors(d,b),M.y>0?Rt(q(M.y)):M.y<0&&Jt(q(M.y)),b.copy(d),t.update()}function sn(i){D.set(i.clientX,i.clientY),E.subVectors(D,A).multiplyScalar(t.panSpeed),J(E.x,E.y),A.copy(D),t.update()}function rn(i){St(i.clientX,i.clientY),i.deltaY<0?Jt(q(i.deltaY)):i.deltaY>0&&Rt(q(i.deltaY)),t.update()}function an(i){let u=!1;switch(i.code){case t.keys.UP:i.ctrlKey||i.metaKey||i.shiftKey?$(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(0,t.keyPanSpeed),u=!0;break;case t.keys.BOTTOM:i.ctrlKey||i.metaKey||i.shiftKey?$(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(0,-t.keyPanSpeed),u=!0;break;case t.keys.LEFT:i.ctrlKey||i.metaKey||i.shiftKey?Z(2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(t.keyPanSpeed,0),u=!0;break;case t.keys.RIGHT:i.ctrlKey||i.metaKey||i.shiftKey?Z(-2*Math.PI*t.rotateSpeed/t.domElement.clientHeight):J(-t.keyPanSpeed,0),u=!0;break}u&&(i.preventDefault(),t.update())}function ee(i){if(I.length===1)g.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);g.set(y,C)}}function ne(i){if(I.length===1)A.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);A.set(y,C)}}function oe(i){const u=v(i),y=i.pageX-u.x,C=i.pageY-u.y,k=Math.sqrt(y*y+C*C);b.set(0,k)}function cn(i){t.enableZoom&&oe(i),t.enablePan&&ne(i)}function ln(i){t.enableZoom&&oe(i),t.enableRotate&&ee(i)}function se(i){if(I.length==1)x.set(i.pageX,i.pageY);else{const y=v(i),C=.5*(i.pageX+y.x),k=.5*(i.pageY+y.y);x.set(C,k)}P.subVectors(x,g).multiplyScalar(t.rotateSpeed);const u=t.domElement;Z(2*Math.PI*P.x/u.clientHeight),$(2*Math.PI*P.y/u.clientHeight),g.copy(x)}function ie(i){if(I.length===1)D.set(i.pageX,i.pageY);else{const u=v(i),y=.5*(i.pageX+u.x),C=.5*(i.pageY+u.y);D.set(y,C)}E.subVectors(D,A).multiplyScalar(t.panSpeed),J(E.x,E.y),A.copy(D)}function re(i){const u=v(i),y=i.pageX-u.x,C=i.pageY-u.y,k=Math.sqrt(y*y+C*C);d.set(0,k),M.set(0,Math.pow(d.y/b.y,t.zoomSpeed)),Rt(M.y),b.copy(d);const _=(i.pageX+u.x)*.5,F=(i.pageY+u.y)*.5;St(_,F)}function hn(i){t.enableZoom&&re(i),t.enablePan&&ie(i)}function pn(i){t.enableZoom&&re(i),t.enableRotate&&se(i)}function ae(i){t.enabled!==!1&&(I.length===0&&(t.domElement.setPointerCapture(i.pointerId),t.domElement.addEventListener("pointermove",Lt),t.domElement.addEventListener("pointerup",it)),yn(i),i.pointerType==="touch"?he(i):un(i))}function Lt(i){t.enabled!==!1&&(i.pointerType==="touch"?bn(i):mn(i))}function it(i){switch(gn(i),I.length){case 0:t.domElement.releasePointerCapture(i.pointerId),t.domElement.removeEventListener("pointermove",Lt),t.domElement.removeEventListener("pointerup",it),t.dispatchEvent(we),c=n.NONE;break;case 1:const u=I[0],y=K[u];he({pointerId:u,pageX:y.x,pageY:y.y});break}}function un(i){let u;switch(i.button){case 0:u=t.mouseButtons.LEFT;break;case 1:u=t.mouseButtons.MIDDLE;break;case 2:u=t.mouseButtons.RIGHT;break;default:u=-1}switch(u){case tt.DOLLY:if(t.enableZoom===!1)return;en(i),c=n.DOLLY;break;case tt.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enablePan===!1)return;te(i),c=n.PAN}else{if(t.enableRotate===!1)return;vt(i),c=n.ROTATE}break;case tt.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(t.enableRotate===!1)return;vt(i),c=n.ROTATE}else{if(t.enablePan===!1)return;te(i),c=n.PAN}break;default:c=n.NONE}c!==n.NONE&&t.dispatchEvent(Vt)}function mn(i){switch(c){case n.ROTATE:if(t.enableRotate===!1)return;nn(i);break;case n.DOLLY:if(t.enableZoom===!1)return;on(i);break;case n.PAN:if(t.enablePan===!1)return;sn(i);break}}function ce(i){t.enabled===!1||t.enableZoom===!1||c!==n.NONE||(i.preventDefault(),t.dispatchEvent(Vt),rn(fn(i)),t.dispatchEvent(we))}function fn(i){const u=i.deltaMode,y={clientX:i.clientX,clientY:i.clientY,deltaY:i.deltaY};switch(u){case 1:y.deltaY*=16;break;case 2:y.deltaY*=100;break}return i.ctrlKey&&!G&&(y.deltaY*=10),y}function dn(i){i.key==="Control"&&(G=!0,t.domElement.getRootNode().addEventListener("keyup",le,{passive:!0,capture:!0}))}function le(i){i.key==="Control"&&(G=!1,t.domElement.getRootNode().removeEventListener("keyup",le,{passive:!0,capture:!0}))}function kt(i){t.enabled===!1||t.enablePan===!1||an(i)}function he(i){switch(ue(i),I.length){case 1:switch(t.touches.ONE){case et.ROTATE:if(t.enableRotate===!1)return;ee(i),c=n.TOUCH_ROTATE;break;case et.PAN:if(t.enablePan===!1)return;ne(i),c=n.TOUCH_PAN;break;default:c=n.NONE}break;case 2:switch(t.touches.TWO){case et.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;cn(i),c=n.TOUCH_DOLLY_PAN;break;case et.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;ln(i),c=n.TOUCH_DOLLY_ROTATE;break;default:c=n.NONE}break;default:c=n.NONE}c!==n.NONE&&t.dispatchEvent(Vt)}function bn(i){switch(ue(i),c){case n.TOUCH_ROTATE:if(t.enableRotate===!1)return;se(i),t.update();break;case n.TOUCH_PAN:if(t.enablePan===!1)return;ie(i),t.update();break;case n.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;hn(i),t.update();break;case n.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;pn(i),t.update();break;default:c=n.NONE}}function pe(i){t.enabled!==!1&&i.preventDefault()}function yn(i){I.push(i.pointerId)}function gn(i){delete K[i.pointerId];for(let u=0;u<I.length;u++)if(I[u]==i.pointerId){I.splice(u,1);return}}function ue(i){let u=K[i.pointerId];u===void 0&&(u=new V,K[i.pointerId]=u),u.set(i.pageX,i.pageY)}function v(i){const u=i.pointerId===I[0]?I[1]:I[0];return K[u]}t.domElement.addEventListener("contextmenu",pe),t.domElement.addEventListener("pointerdown",ae),t.domElement.addEventListener("pointercancel",it),t.domElement.addEventListener("wheel",ce,{passive:!1}),t.domElement.getRootNode().addEventListener("keydown",dn,{passive:!0,capture:!0}),this.update()}}let wt;const An=new Uint8Array(16);function Dn(){if(!wt&&(wt=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!wt))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return wt(An)}const L=[];for(let o=0;o<256;++o)L.push((o+256).toString(16).slice(1));function In(o,s=0){return L[o[s+0]]+L[o[s+1]]+L[o[s+2]]+L[o[s+3]]+"-"+L[o[s+4]]+L[o[s+5]]+"-"+L[o[s+6]]+L[o[s+7]]+"-"+L[o[s+8]]+L[o[s+9]]+"-"+L[o[s+10]]+L[o[s+11]]+L[o[s+12]]+L[o[s+13]]+L[o[s+14]]+L[o[s+15]]}const Rn=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pe={randomUUID:Rn};function Sn(o,s,e){if(Pe.randomUUID&&!s&&!o)return Pe.randomUUID();o=o||{};const t=o.random||(o.rng||Dn)();if(t[6]=t[6]&15|64,t[8]=t[8]&63|128,s){e=e||0;for(let n=0;n<16;++n)s[e+n]=t[n];return s}return In(t)}class Ct extends On{constructor(...e){super();w(this,"key");w(this,"movable",!1);w(this,"mirrorComponent");w(this,"color");w(this,"objectType","Component");this.key=Sn(),this.generateElement(...e),this.mirrorComponent=null}setName(e){return this.name=e,this}}function Le(o,s){var e={};for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&s.indexOf(t)<0&&(e[t]=o[t]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(o);n<t.length;n++)s.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(o,t[n])&&(e[t[n]]=o[t[n]]);return e}var Ee=function(){};const Ht=(o,s,e)=>Math.min(Math.max(e,o),s),Ut=.001,Nn=.01,Ln=10,kn=.05,Fn=1;function Vn({duration:o=800,bounce:s=.25,velocity:e=0,mass:t=1}){let n,c,a=1-s;a=Ht(kn,Fn,a),o=Ht(Nn,Ln,o/1e3),a<1?(n=p=>{const f=p*a,g=f*o,x=f-e,P=Kt(p,a),A=Math.exp(-g);return Ut-x/P*A},c=p=>{const g=p*a*o,x=g*e+e,P=Math.pow(a,2)*Math.pow(p,2)*o,A=Math.exp(-g),D=Kt(Math.pow(p,2),a);return(-n(p)+Ut>0?-1:1)*((x-P)*A)/D}):(n=p=>{const f=Math.exp(-p*o),g=(p-e)*o+1;return-Ut+f*g},c=p=>{const f=Math.exp(-p*o),g=(e-p)*(o*o);return f*g});const r=5/o,l=Yn(n,c,r);if(o=o*1e3,isNaN(l))return{stiffness:100,damping:10,duration:o};{const p=Math.pow(l,2)*t;return{stiffness:p,damping:a*2*Math.sqrt(t*p),duration:o}}}const Un=12;function Yn(o,s,e){let t=e;for(let n=1;n<Un;n++)t=t-o(t)/s(t);return t}function Kt(o,s){return o*Math.sqrt(1-s*s)}const zn=["duration","bounce"],Hn=["stiffness","damping","mass"];function Oe(o,s){return s.some(e=>o[e]!==void 0)}function Kn(o){let s=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},o);if(!Oe(o,Hn)&&Oe(o,zn)){const e=Vn(o);s=Object.assign(Object.assign(Object.assign({},s),e),{velocity:0,mass:1}),s.isResolvedFromDuration=!0}return s}function Gt(o){var{from:s=0,to:e=1,restSpeed:t=2,restDelta:n}=o,c=Le(o,["from","to","restSpeed","restDelta"]);const a={done:!1,value:s};let{stiffness:r,damping:l,mass:p,velocity:f,duration:g,isResolvedFromDuration:x}=Kn(c),P=je,A=je;function D(){const E=f?-(f/1e3):0,b=e-s,d=l/(2*Math.sqrt(r*p)),M=Math.sqrt(r/p)/1e3;if(n===void 0&&(n=Math.min(Math.abs(e-s)/100,.4)),d<1){const O=Kt(M,d);P=j=>{const N=Math.exp(-d*M*j);return e-N*((E+d*M*b)/O*Math.sin(O*j)+b*Math.cos(O*j))},A=j=>{const N=Math.exp(-d*M*j);return d*M*N*(Math.sin(O*j)*(E+d*M*b)/O+b*Math.cos(O*j))-N*(Math.cos(O*j)*(E+d*M*b)-O*b*Math.sin(O*j))}}else if(d===1)P=O=>e-Math.exp(-M*O)*(b+(E+M*b)*O);else{const O=M*Math.sqrt(d*d-1);P=j=>{const N=Math.exp(-d*M*j),I=Math.min(O*j,300);return e-N*((E+d*M*b)*Math.sinh(I)+O*b*Math.cosh(I))/O}}}return D(),{next:E=>{const b=P(E);if(x)a.done=E>=g;else{const d=A(E)*1e3,M=Math.abs(d)<=t,O=Math.abs(e-b)<=n;a.done=M&&O}return a.value=a.done?e:b,a},flipTarget:()=>{f=-f,[s,e]=[e,s],D()}}}Gt.needsInterpolation=(o,s)=>typeof o=="string"||typeof s=="string";const je=o=>0,ke=(o,s,e)=>{const t=s-o;return t===0?1:(e-o)/t},qt=(o,s,e)=>-e*o+e*s+o,Fe=(o,s)=>e=>Math.max(Math.min(e,s),o),lt=o=>o%1?Number(o.toFixed(5)):o,Ot=/(-)?([\d]*\.?[\d])+/g,_t=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,_n=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function ft(o){return typeof o=="string"}const Tt={test:o=>typeof o=="number",parse:parseFloat,transform:o=>o},Ve=Object.assign(Object.assign({},Tt),{transform:Fe(0,1)});Object.assign(Object.assign({},Tt),{default:1});const Bn=o=>({test:s=>ft(s)&&s.endsWith(o)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${o}`}),ht=Bn("%");Object.assign(Object.assign({},ht),{parse:o=>ht.parse(o)/100,transform:o=>ht.transform(o*100)});const $t=(o,s)=>e=>!!(ft(e)&&_n.test(e)&&e.startsWith(o)||s&&Object.prototype.hasOwnProperty.call(e,s)),Ue=(o,s,e)=>t=>{if(!ft(t))return t;const[n,c,a,r]=t.match(Ot);return{[o]:parseFloat(n),[s]:parseFloat(c),[e]:parseFloat(a),alpha:r!==void 0?parseFloat(r):1}},W={test:$t("hsl","hue"),parse:Ue("hue","saturation","lightness"),transform:({hue:o,saturation:s,lightness:e,alpha:t=1})=>"hsla("+Math.round(o)+", "+ht.transform(lt(s))+", "+ht.transform(lt(e))+", "+lt(Ve.transform(t))+")"},Xn=Fe(0,255),Yt=Object.assign(Object.assign({},Tt),{transform:o=>Math.round(Xn(o))}),X={test:$t("rgb","red"),parse:Ue("red","green","blue"),transform:({red:o,green:s,blue:e,alpha:t=1})=>"rgba("+Yt.transform(o)+", "+Yt.transform(s)+", "+Yt.transform(e)+", "+lt(Ve.transform(t))+")"};function Zn(o){let s="",e="",t="",n="";return o.length>5?(s=o.substr(1,2),e=o.substr(3,2),t=o.substr(5,2),n=o.substr(7,2)):(s=o.substr(1,1),e=o.substr(2,1),t=o.substr(3,1),n=o.substr(4,1),s+=s,e+=e,t+=t,n+=n),{red:parseInt(s,16),green:parseInt(e,16),blue:parseInt(t,16),alpha:n?parseInt(n,16)/255:1}}const Bt={test:$t("#"),parse:Zn,transform:X.transform},At={test:o=>X.test(o)||Bt.test(o)||W.test(o),parse:o=>X.test(o)?X.parse(o):W.test(o)?W.parse(o):Bt.parse(o),transform:o=>ft(o)?o:o.hasOwnProperty("red")?X.transform(o):W.transform(o)},Ye="${c}",ze="${n}";function Wn(o){var s,e,t,n;return isNaN(o)&&ft(o)&&((e=(s=o.match(Ot))===null||s===void 0?void 0:s.length)!==null&&e!==void 0?e:0)+((n=(t=o.match(_t))===null||t===void 0?void 0:t.length)!==null&&n!==void 0?n:0)>0}function He(o){typeof o=="number"&&(o=`${o}`);const s=[];let e=0;const t=o.match(_t);t&&(e=t.length,o=o.replace(_t,Ye),s.push(...t.map(At.parse)));const n=o.match(Ot);return n&&(o=o.replace(Ot,ze),s.push(...n.map(Tt.parse))),{values:s,numColors:e,tokenised:o}}function Ke(o){return He(o).values}function _e(o){const{values:s,numColors:e,tokenised:t}=He(o),n=s.length;return c=>{let a=t;for(let r=0;r<n;r++)a=a.replace(r<e?Ye:ze,r<e?At.transform(c[r]):lt(c[r]));return a}}const Gn=o=>typeof o=="number"?0:o;function qn(o){const s=Ke(o);return _e(o)(s.map(Gn))}const Be={test:Wn,parse:Ke,createTransformer:_e,getAnimatableNone:qn};function zt(o,s,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?o+(s-o)*6*e:e<1/2?s:e<2/3?o+(s-o)*(2/3-e)*6:o}function Ce({hue:o,saturation:s,lightness:e,alpha:t}){o/=360,s/=100,e/=100;let n=0,c=0,a=0;if(!s)n=c=a=e;else{const r=e<.5?e*(1+s):e+s-e*s,l=2*e-r;n=zt(l,r,o+1/3),c=zt(l,r,o),a=zt(l,r,o-1/3)}return{red:Math.round(n*255),green:Math.round(c*255),blue:Math.round(a*255),alpha:t}}const $n=(o,s,e)=>{const t=o*o,n=s*s;return Math.sqrt(Math.max(0,e*(n-t)+t))},Qn=[Bt,X,W],Te=o=>Qn.find(s=>s.test(o)),Xe=(o,s)=>{let e=Te(o),t=Te(s),n=e.parse(o),c=t.parse(s);e===W&&(n=Ce(n),e=X),t===W&&(c=Ce(c),t=X);const a=Object.assign({},n);return r=>{for(const l in a)l!=="alpha"&&(a[l]=$n(n[l],c[l],r));return a.alpha=qt(n.alpha,c.alpha,r),e.transform(a)}},Jn=o=>typeof o=="number",vn=(o,s)=>e=>s(o(e)),Ze=(...o)=>o.reduce(vn);function We(o,s){return Jn(o)?e=>qt(o,s,e):At.test(o)?Xe(o,s):qe(o,s)}const Ge=(o,s)=>{const e=[...o],t=e.length,n=o.map((c,a)=>We(c,s[a]));return c=>{for(let a=0;a<t;a++)e[a]=n[a](c);return e}},to=(o,s)=>{const e=Object.assign(Object.assign({},o),s),t={};for(const n in e)o[n]!==void 0&&s[n]!==void 0&&(t[n]=We(o[n],s[n]));return n=>{for(const c in t)e[c]=t[c](n);return e}};function Ae(o){const s=Be.parse(o),e=s.length;let t=0,n=0,c=0;for(let a=0;a<e;a++)t||typeof s[a]=="number"?t++:s[a].hue!==void 0?c++:n++;return{parsed:s,numNumbers:t,numRGB:n,numHSL:c}}const qe=(o,s)=>{const e=Be.createTransformer(s),t=Ae(o),n=Ae(s);return t.numHSL===n.numHSL&&t.numRGB===n.numRGB&&t.numNumbers>=n.numNumbers?Ze(Ge(t.parsed,n.parsed),e):a=>`${a>0?s:o}`},eo=(o,s)=>e=>qt(o,s,e);function no(o){if(typeof o=="number")return eo;if(typeof o=="string")return At.test(o)?Xe:qe;if(Array.isArray(o))return Ge;if(typeof o=="object")return to}function oo(o,s,e){const t=[],n=e||no(o[0]),c=o.length-1;for(let a=0;a<c;a++){let r=n(o[a],o[a+1]);if(s){const l=Array.isArray(s)?s[a]:s;r=Ze(l,r)}t.push(r)}return t}function so([o,s],[e]){return t=>e(ke(o,s,t))}function io(o,s){const e=o.length,t=e-1;return n=>{let c=0,a=!1;if(n<=o[0]?a=!0:n>=o[t]&&(c=t-1,a=!0),!a){let l=1;for(;l<e&&!(o[l]>n||l===t);l++);c=l-1}const r=ke(o[c],o[c+1],n);return s[c](r)}}function $e(o,s,{clamp:e=!0,ease:t,mixer:n}={}){const c=o.length;Ee(c===s.length),Ee(!t||!Array.isArray(t)||t.length===c-1),o[0]>o[c-1]&&(o=[].concat(o),s=[].concat(s),o.reverse(),s.reverse());const a=oo(s,t,n),r=c===2?so(o,a):io(o,a);return e?l=>r(Ht(o[0],o[c-1],l)):r}const ro=o=>s=>s<=.5?o(2*s)/2:(2-o(2*(1-s)))/2,ao=o=>s=>Math.pow(s,o),co=o=>s=>s*s*((o+1)*s-o),lo=o=>{const s=co(o);return e=>(e*=2)<1?.5*s(e):.5*(2-Math.pow(2,-10*(e-1)))},ho=1.525,po=ao(2),uo=ro(po);lo(ho);function mo(o,s){return o.map(()=>s||uo).splice(0,o.length-1)}function fo(o){const s=o.length;return o.map((e,t)=>t!==0?t/(s-1):0)}function bo(o,s){return o.map(e=>e*s)}function Mt({from:o=0,to:s=1,ease:e,offset:t,duration:n=300}){const c={done:!1,value:o},a=Array.isArray(s)?s:[o,s],r=bo(t&&t.length===a.length?t:fo(a),n);function l(){return $e(r,a,{ease:Array.isArray(e)?e:mo(a,e)})}let p=l();return{next:f=>(c.value=p(f),c.done=f>=n,c),flipTarget:()=>{a.reverse(),p=l()}}}function yo({velocity:o=0,from:s=0,power:e=.8,timeConstant:t=350,restDelta:n=.5,modifyTarget:c}){const a={done:!1,value:s};let r=e*o;const l=s+r,p=c===void 0?l:c(l);return p!==l&&(r=p-s),{next:f=>{const g=-r*Math.exp(-f/t);return a.done=!(g>n||g<-n),a.value=a.done?p:p+g,a},flipTarget:()=>{}}}const De={keyframes:Mt,spring:Gt,decay:yo};function go(o){if(Array.isArray(o.to))return Mt;if(De[o.type])return De[o.type];const s=new Set(Object.keys(o));return s.has("ease")||s.has("duration")&&!s.has("dampingRatio")?Mt:s.has("dampingRatio")||s.has("stiffness")||s.has("mass")||s.has("damping")||s.has("restSpeed")||s.has("restDelta")?Gt:Mt}const Qe=1/60*1e3,xo=typeof performance<"u"?()=>performance.now():()=>Date.now(),Je=typeof window<"u"?o=>window.requestAnimationFrame(o):o=>setTimeout(()=>o(xo()),Qe);function wo(o){let s=[],e=[],t=0,n=!1,c=!1;const a=new WeakSet,r={schedule:(l,p=!1,f=!1)=>{const g=f&&n,x=g?s:e;return p&&a.add(l),x.indexOf(l)===-1&&(x.push(l),g&&n&&(t=s.length)),l},cancel:l=>{const p=e.indexOf(l);p!==-1&&e.splice(p,1),a.delete(l)},process:l=>{if(n){c=!0;return}if(n=!0,[s,e]=[e,s],e.length=0,t=s.length,t)for(let p=0;p<t;p++){const f=s[p];f(l),a.has(f)&&(r.schedule(f),o())}n=!1,c&&(c=!1,r.process(l))}};return r}const Mo=40;let Xt=!0,mt=!1,Zt=!1;const pt={delta:0,timestamp:0},dt=["read","update","preRender","render","postRender"],Dt=dt.reduce((o,s)=>(o[s]=wo(()=>mt=!0),o),{}),Po=dt.reduce((o,s)=>{const e=Dt[s];return o[s]=(t,n=!1,c=!1)=>(mt||jo(),e.schedule(t,n,c)),o},{}),Eo=dt.reduce((o,s)=>(o[s]=Dt[s].cancel,o),{});dt.reduce((o,s)=>(o[s]=()=>Dt[s].process(pt),o),{});const Oo=o=>Dt[o].process(pt),ve=o=>{mt=!1,pt.delta=Xt?Qe:Math.max(Math.min(o-pt.timestamp,Mo),1),pt.timestamp=o,Zt=!0,dt.forEach(Oo),Zt=!1,mt&&(Xt=!1,Je(ve))},jo=()=>{mt=!0,Xt=!0,Zt||Je(ve)},Co=Po;function tn(o,s,e=0){return o-s-e}function To(o,s,e=0,t=!0){return t?tn(s+-o,s,e):s-(o-s)+e}function Ao(o,s,e,t){return t?o>=s+e:o<=-e}const Do=o=>{const s=({delta:e})=>o(e);return{start:()=>Co.update(s,!0),stop:()=>Eo.update(s)}};function jt(o){var s,e,{from:t,autoplay:n=!0,driver:c=Do,elapsed:a=0,repeat:r=0,repeatType:l="loop",repeatDelay:p=0,onPlay:f,onStop:g,onComplete:x,onRepeat:P,onUpdate:A}=o,D=Le(o,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:E}=D,b,d=0,M=D.duration,O,j=!1,N=!0,I;const K=go(D);!((e=(s=K).needsInterpolation)===null||e===void 0)&&e.call(s,t,E)&&(I=$e([0,100],[t,E],{clamp:!1}),t=0,E=100);const G=K(Object.assign(Object.assign({},D),{from:t,to:E}));function It(){d++,l==="reverse"?(N=d%2===0,a=To(a,M,p,N)):(a=tn(a,M,p),l==="mirror"&&G.flipTarget()),j=!1,P&&P()}function q(){b.stop(),x&&x()}function Z(Q){if(N||(Q=-Q),a+=Q,!j){const st=G.next(Math.max(0,a));O=st.value,I&&(O=I(O)),j=N?st.done:a<=0}A==null||A(O),j&&(d===0&&(M??(M=a)),d<r?Ao(a,M,p,N)&&It():q())}function $(){f==null||f(),b=c(Z),b.start()}return n&&$(),{stop:()=>{g==null||g(),b.stop()}}}class Qt extends Ct{constructor(...e){super(...e);w(this,"pos");this.objectType="Cube",this.pos=e[0],this.color=(e==null?void 0:e[1])||"#54c8ff"}generateElement(...e){this.generateCube(e[0],e==null?void 0:e[1])}generateCube(e,t=5556479){const n=new ot(h,h,h),c=new Wt({color:t}),a=new ut(n,c);a.position.x=T(e[0],1),a.position.y=T(e[1],1),a.position.z=T(e[2],1),a.applyMatrix4(new Se().makeScale(1,1,1)),this.add(a)}setPos(e){this.pos=e,this.children.forEach(t=>{t.position.x=T(e[0],1),t.position.y=T(e[1],1),t.position.z=T(e[2],1)})}setPosAnimate(e){this.pos=e;const t=new m(T(e[0],1),T(e[1],1),T(e[2],1));jt({from:this.children[0].position,to:t,onUpdate:n=>{this.children[0].position.copy(n)}})}setColor(e){this.color=e;const t="#"+this.children[0].material.color.getHexString();jt({from:t,to:e,onUpdate:n=>{this.children[0].material.color.setStyle(n),this.mirrorComponent&&this.mirrorComponent.children[0].material.color.setStyle(n)}})}detechCollide(e){const t=this.children[0],n=new Pt().setFromObject(t);return Et(e,n)}}Qt.cnName="正方体";Qt.enName="Cube";const S=(o,s=1)=>o*h+h*(s||1)/2,Ie=(o,s=1)=>Math.round((o-h*(s||1)/2)/h);class Io extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"range");w(this,"mirrorInfo",{pos:[0,0,0],face:0});this.movable=!0,this.objectType="Drawbox",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[1,1,1],this.range=(e==null?void 0:e[2])||[[1],[1],[1]],this.color=(e==null?void 0:e[3])||"#ffe21f"}generateElement(...e){this.generateDrawbox(e[0],e[1],e[3])}generateDrawbox(e,t,n=16769567){const c=new ot(h*(t[0]||1),h*(t[1]||1),h*(t[2]||1)),a=new Wt({color:n}),r=new ut(c,a);r.position.x=S(e[0],t[0]),r.position.y=S(e[1],t[1]),r.position.z=S(e[2],t[2]),this.add(r)}setPos(e){if(this.pos=e,this.children.forEach(t=>{t.position.x=S(e[0],this.len[0]),t.position.y=S(e[1],this.len[1]),t.position.z=S(e[2],this.len[2])}),this.mirrorComponent){const t=z(this.pos,this.mirrorInfo.pos,this.mirrorInfo.face);t[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(t)}}setPosAnimate(e){this.pos=e;const t=new m(S(e[0],this.len[0]),S(e[1],this.len[1]),S(e[2],this.len[2]));jt({from:this.children[0].position,to:t,onUpdate:n=>{this.children[0].position.copy(n)}})}setSize(e){this.len=e,this.children.forEach(t=>{const n=t;n==null||n.geometry.dispose(),n.geometry=new ot(h*(e[0]||1),h*(e[1]||1),h*(e[2]||1)),n.position.x=S(this.pos[0],e[0]),n.position.y=S(this.pos[1],e[1]),n.position.z=S(this.pos[2],e[2])})}setRange(e){this.range=e}setColor(e){this.color=e,this.children.forEach(t=>{var n;(n=t==null?void 0:t.material)==null||n.color.setStyle(e)}),this.mirrorComponent&&this.mirrorComponent.children.forEach(t=>{var n;(n=t==null?void 0:t.material)==null||n.color.setStyle(e)})}onControlDrag(e){const t=e.object.position.toArray();for(let n=0;n<3;++n)this.range[n].length===2&&this.range[n][0]<this.range[n][1]?(t[n]<=S(this.range[n][0],this.len[n])&&(t[n]=S(this.range[n][0],this.len[n])),t[n]>=S(this.range[n][1],this.len[n])&&(t[n]=S(this.range[n][1],this.len[n]))):t[n]=S(this.pos[n],this.len[n]),this.pos[n]=Ie(t[n],this.len[n]);if(e.object.position.fromArray(t),this.mirrorComponent){let n=[0,0,0];for(let c=0;c<n.length;++c)n[c]=(t[c]-h*(this.len[c]||1)/2)/h;n=z(n,this.mirrorInfo.pos,this.mirrorInfo.face),n[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(n)}}onControlDragEnd(e){const t=e.object.position.toArray();for(let n=0;n<3;++n)this.pos[n]=Ie(t[n],this.len[n]),t[n]=S(this.pos[n],this.len[n]);if(e.object.position.fromArray(t),this.mirrorComponent){const n=z(this.pos,this.mirrorInfo.pos,this.mirrorInfo.face);n[this.mirrorInfo.face]-=this.len[this.mirrorInfo.face]-1,this.mirrorComponent.setPos(n)}}onDragEnd(){}detechCollide(e){const t=this.children[0],n=new Pt().setFromObject(t);return Et(e,n)}}const R=(o,s=1)=>(o||0)*h+h*(s||1)/2;class Ro extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"startVector",null);w(this,"mirrorInfo",{face:0});w(this,"plane");w(this,"angle");w(this,"face");w(this,"enabled",!0);w(this,"direction",1);w(this,"angleAccumulate",0);this.movable=!0,this.objectType="Rotator",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[4,4],this.angle=(e==null?void 0:e[3])||0,this.face=(e==null?void 0:e[5])||["+x","+y"],this.direction=(e==null?void 0:e[4])||0,this.plane=new H(new m(0,1,0),-R(this.pos[1],1)),this.color=(e==null?void 0:e[2])||"#fb8888",this.setFace(this.face),this.setDirection(this.direction)}setFace(e){var g;this.face=e;const t=this.children[0],n=this.children[1];function c(x,P,A){x.geometry.dispose();const E={x:[P,1,1],y:[1,P,1],z:[1,1,P]}[A];x.geometry=new ot(...E.map(b=>h*b))}const a=e[0][1];c(t,this.len[0],a);const r=["x","y","z"];for(const x of r)if(x===a){const P=e[0][0]==="+"?-.5:.5-this.len[0];t.position[x]=R(P,this.len[0])}else t.position[x]=R(-1/2);const l=e[1][1];c(n,this.len[1],l);for(const x of r)if(x===l){const P=e[1][0]==="+"?-.5:.5-this.len[1];n.position[x]=R(P,this.len[1])}else n.position[x]=R(-1/2);function p(x){return x==="+"?"-":"+"}const f=["x","y","z"][this.mirrorInfo.face];(g=this.mirrorComponent)==null||g.setFace([(e[0][1]!==f?e[0][0]:p(e[0][0]))+e[0][1],(e[1][1]!==f?e[1][0]:p(e[1][0]))+e[1][1]])}setDirection(e){var t;this.direction=(Math.floor(e)||0)%3,this.setAngle(this.angle),this.plane=new H(new m(+(this.direction===0),+(this.direction===1),+(this.direction===2)),-R(this.pos[this.direction],1)),(t=this.mirrorComponent)==null||t.setDirection(this.direction)}setAngle(e){var n;this.angle=((Math.floor(e)||0)%4+4)%4;const t=[0,0,0];t[this.direction]=Math.PI*e/2,this.rotation.x=t[0],this.rotation.y=t[1],this.rotation.z=t[2],(n=this.mirrorComponent)==null||n.setAngle(this.angle*(this.mirrorInfo.face===this.direction?1:-1))}setPos(e){this.pos=e,this.position.set(h*(e[0]+1/2),h*(e[1]+1/2),h*(e[2]+1/2))}setPosAnimate(e){this.pos=e;const t=new m(h*(e[0]+1/2),h*(e[1]+1/2),h*(e[2]+1/2));jt({from:this.position,to:t,onUpdate:n=>{this.position.copy(n)}})}setSize(e){var t;this.len=e,this.setFace(this.face),(t=this.mirrorComponent)==null||t.setSize([this.len[0],this.len[1]])}setColor(e){this.color=e,this.children.forEach(t=>{var n;(n=t==null?void 0:t.material)==null||n.color.setStyle(e)}),this.mirrorComponent&&this.mirrorComponent.children.forEach(t=>{var n;(n=t==null?void 0:t.material)==null||n.color.setStyle(e)})}generateElement(...e){this.generateDrawbox(e[0],e[1],e[2])}generateDrawbox(e,t,n=16484488){const c=new ot(h*t[0],h,h),a=new Wt({color:n}),r=new ut(c,a);r.position.x=R(-1/2,t[0]),r.position.y=R(-1/2),r.position.z=R(-1/2);const l=new ot(h,h,h*t[1]),p=new ut(l,a);p.position.x=R(-1/2),p.position.y=R(-1/2),p.position.z=R(-1/2,t[1]),this.add(r),this.add(p),this.position.set(h*(e[0]+1/2),h*(e[1]+1/2),h*(e[2]+1/2))}onDragStart(e){if(!this.enabled)return;this.angleAccumulate=this.angle*Math.PI/2;const t=new m;e.ray.intersectPlane(this.plane,t),this.startVector=t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])})}onDrag(e){var a;if(!this.enabled||this.startVector===null)return;const t=new m;e.ray.intersectPlane(this.plane,t),t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])});const n=new m;n.crossVectors(this.startVector,t);let c=((a=this.startVector)==null?void 0:a.angleTo(t))||0;this.startVector=t,this.position.set(h/2,h/2,h/2),c*=this.direction===0&&n.x<0||this.direction===1&&n.y<0||this.direction===2&&n.z<0?-1:1,this.angleAccumulate+=c,this.angleAccumulate=(this.angleAccumulate%(Math.PI*2)+Math.PI*2)%(Math.PI*2),this.rotation.fromArray([0,1,2].map(r=>this.angleAccumulate*+(r===this.direction))),this.position.set(h*(this.pos[0]+1/2),h*(this.pos[1]+1/2),h*(this.pos[2]+1/2)),this.mirrorComponent&&(this.mirrorComponent.position.set(h/2,h/2,h/2),this.mirrorComponent.rotation.fromArray([0,1,2].map(r=>this.angleAccumulate*+(r===this.direction)*(this.mirrorInfo.face===this.direction?1:-1))),this.mirrorComponent.position.set(h*(this.mirrorComponent.pos[0]+1/2),h*(this.mirrorComponent.pos[1]+1/2),h*(this.mirrorComponent.pos[2]+1/2)))}onDragEnd(e){var a,r;if(!this.enabled||this.startVector===null)return;const t=new m;e.ray.intersectPlane(this.plane,t),t.sub({x:R(this.pos[0]),y:R(this.pos[1]),z:R(this.pos[2])});const n=new m;n.crossVectors(this.startVector,t);let c=((a=this.startVector)==null?void 0:a.angleTo(t))||0;this.startVector=t,this.position.set(-h/2,-h/2,-h/2),c*=this.direction===0&&n.x<0||this.direction===1&&n.y<0||this.direction===2&&n.z<0?-1:1,this.angleAccumulate+=c,this.angle=Math.round(this.angleAccumulate*2/Math.PI),this.angle=(this.angle%4+4)%4,this.angleAccumulate=this.angle*Math.PI/2,this.rotation.fromArray([0,1,2].map(l=>this.angleAccumulate*+(l===this.direction))),this.position.set(h*(this.pos[0]+1/2),h*(this.pos[1]+1/2),h*(this.pos[2]+1/2)),(r=this.mirrorComponent)==null||r.setAngle(this.angle*(this.mirrorInfo.face===this.direction?1:-1))}detechCollide(e){const t=this.children[0],n=this.children[0],c=new Pt().setFromObject(t),a=new Pt().setFromObject(n);return Et(e,c)||Et(e,a)}}class Yo extends Ct{constructor(...e){super(...e);w(this,"pos");w(this,"len");w(this,"range");w(this,"inMirrorObjs",[]);w(this,"realObjs",[]);w(this,"clippingPlanes",[]);this.movable=!0,this.objectType="Mirror",this.pos=(e==null?void 0:e[0])||[0,0,0],this.len=(e==null?void 0:e[1])||[1,1,0],this.range=(e==null?void 0:e[2])||[[1],[1],[1]],this.color="0xffffff"}generateElement(...e){this.generateDrawbox(e[0],e[1])}generateDrawbox(e,t){const n=new be(h*(t[0]+t[2]),h*(t[1]||1)),c=new jn({color:16777215,transparent:!0,opacity:.5}),a=new ut(n,c);a.position.x=T(e[0],t[0],t[0]===0),a.position.y=T(e[1],t[1]),a.position.z=T(e[2],t[2],t[2]===0),t[0]===0&&(a.rotation.y=Math.PI/2),this.add(a)}updateMirrorCubePos(e){const t=e||this.parent,n=this.len[0]===0?0:2,c=["x","y","z"][n];function a(r){return r==="+"?"-":"+"}this.realObjs.forEach(r=>{let l,p;if(r.mirrorComponent)switch(r.objectType){case"Cube":r.mirrorComponent.setPos(z(r.pos,this.pos,n));break;case"Drawbox":p=z(r.pos,this.pos,n),p[n]-=r.len[n]-1,r.mirrorComponent.setPos(p),r.mirrorInfo={pos:this.pos,face:n};break;case"Rotator":r.mirrorComponent.setPos(z(r.pos,this.pos,n)),r.mirrorComponent.setFace([(r.face[0][1]!==c?r.face[0][0]:a(r.face[0][0]))+r.face[0][1],(r.face[1][1]!==c?r.face[1][0]:a(r.face[1][0]))+r.face[1][1]]),r.mirrorComponent.setAngle(r.angle*(r.direction===n?1:-1)),r.mirrorInfo={face:n};break}else switch(r.objectType){case"Cube":l=new Qt(z(r.pos,this.pos,n),r.color),r.mirrorComponent=l,this.inMirrorObjs.push(l),t.add(l);break;case"Rotator":l=new Ro(z(r.pos,this.pos,n),[r.len[0],r.len[1]],r.color,r.angle*(r.direction===n?1:-1),r.direction,[(r.face[0][1]!==c?r.face[0][0]:a(r.face[0][0]))+r.face[0][1],(r.face[1][1]!==c?r.face[1][0]:a(r.face[1][0]))+r.face[1][1]]),l.enabled=!1,r.mirrorComponent=l,r.mirrorInfo={face:n},this.inMirrorObjs.push(l),t.add(l);break;case"Drawbox":p=z(r.pos,this.pos,n),p[n]-=r.len[n]-1,l=new Io(p,r.len,r.color),r.mirrorComponent=l,r.mirrorInfo={pos:this.pos,face:n},this.inMirrorObjs.push(l),t.add(l);break}})}setPos(e){this.pos=e,this.children.forEach(t=>{const n=t;n.position.x=T(e[0],this.len[0],this.len[0]===0),n.position.y=T(e[1],this.len[1]),n.position.z=T(e[2],this.len[2],this.len[2]===0)}),this.updateMirrorCubePos(),this.handleObjectVisibility()}setSize(e){this.len=e,this.children.forEach(t=>{const n=t;n.geometry&&(n.geometry.dispose(),n.geometry=new be(h*(e[0]+e[2]),h*(e[1]||1))),e[0]===0&&(n.rotation.y=Math.PI/2),n.position.x=T(this.pos[0],e[0],e[0]===0),n.position.y=T(this.pos[1],e[1]),n.position.z=T(this.pos[2],e[2],e[2]===0)}),this.updateMirrorCubePos(),this.handleObjectVisibility()}setRange(e){this.range=e}handleObjectVisibility(){const e=this.len[0]===0?0:2,t=this.children[0],n=e===2?(t.position.x-h*this.len[0]/2)/h:(t.position.z-h*this.len[2]/2)/h,c=n+this.len[0]+this.len[2],a=(t.position.y-h*this.len[1]/2)/h,r=a+this.len[1];this.clippingPlanes=[new H().setFromNormalAndCoplanarPoint(e===2?new m(0,0,-1):new m(-1,0,0),e===2?new m(0,0,this.pos[2]*h):new m(this.pos[0]*h,0,0)),new H().setFromNormalAndCoplanarPoint(e===2?new m(1,0,-1):new m(-1,0,1),e===2?new m(n*h/2,0,this.pos[2]*h/2):new m(this.pos[0]*h/2,0,n*h/2)),new H().setFromNormalAndCoplanarPoint(e===2?new m(-1,0,1):new m(1,0,-1),e===2?new m(c*h/2,0,this.pos[2]*h/2):new m(this.pos[0]*h/2,0,c*h/2)),new H().setFromNormalAndCoplanarPoint(e===2?new m(0,-1,1):new m(1,-1,0),e===2?new m(0,r*h/2,this.pos[2]*h/2):new m(this.pos[0]*h/2,r*h/2,0)),new H().setFromNormalAndCoplanarPoint(e===2?new m(0,1,-1):new m(-1,1,0),e===2?new m(0,a*h/2,this.pos[2]*h/2):new m(this.pos[0]*h/2,a*h/2,0))],this.inMirrorObjs.forEach(p=>{p.children.forEach(f=>{f.material.clippingPlanes=this.clippingPlanes,f.material.clipIntersection=!1})});const l=[];for(const p of this.clippingPlanes)l.push(p.clone().negate());this.realObjs.forEach(p=>{p.children.forEach(f=>{f.material.clippingPlanes=l,f.material.clipIntersection=!0})})}onControlDrag(e){const t=e.object.position.toArray();for(let n=0;n<3;++n)this.range[n].length===2&&this.range[n][0]<this.range[n][1]?(t[n]<=T(this.range[n][0],this.len[n])&&(t[n]=T(this.range[n][0],this.len[n],this.len[n]===0)),t[n]>=T(this.range[n][1],this.len[n])&&(t[n]=T(this.range[n][1],this.len[n],this.len[n]===0))):t[n]=T(this.pos[n],this.len[n],this.len[n]===0);e.object.position.fromArray(t),this.handleObjectVisibility()}onControlDragEnd(e){const t=e.object.position.toArray();for(let n=0;n<3;++n)this.pos[n]=Cn(t[n],this.len[n]),t[n]=T(this.pos[n],this.len[n],this.len[n]===0);e.object.position.fromArray(t),this.handleObjectVisibility()}onDragEnd(){}setupMirrorCubes(e,t){this.realObjs=e,this.updateMirrorCubePos(t),this.handleObjectVisibility()}dispose(e){const t=e||this.parent;this.inMirrorObjs.forEach(n=>{n.geometry&&n.geometry.dispose(),t.remove(n)}),this.inMirrorObjs=[],this.realObjs.forEach(n=>{n.mirrorComponent&&(n.mirrorComponent=void 0),n.children.forEach(c=>{c.material.clippingPlanes=null})}),this.children.forEach(n=>{n.geometry&&n.geometry.dispose()})}detechCollide(e){return!1}}class zo{constructor(s){w(this,"raycaster");w(this,"allObjs");w(this,"pickedObject");w(this,"pickedObjectSavedColor",0);w(this,"pickedObjectPoint");this.raycaster=new Re,this.allObjs=s||[]}updateObjs(s){this.allObjs=s}pick(s,e,t){this.pickedObject&&(this.pickedObject=void 0),this.raycaster.setFromCamera(s,t);const n=this.raycaster.intersectObjects(this.allObjs,!0);n.length&&(this.pickedObject=n[0].object,this.pickedObjectPoint=n[0].point)}}export{Qt as C,Vo as D,Yo as M,Uo as O,zo as P,Ro as R,Io as a,jt as b};
